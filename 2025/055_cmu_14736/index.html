<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Bill Hu"><meta name="keywords" content=""><meta name="description" content="CMU 14-736 Notes: Distributed Systems: Techniques, Infrastructure and Services"><meta property="og:type" content="article"><meta property="og:title" content="[Lecture Notes] CMU 14-736 Distributed Systems"><meta property="og:url" content="https://www.billhu.us/2025/055_cmu_14736/index.html"><meta property="og:site_name" content="Bill Hu&#39;s Blog"><meta property="og:description" content="CMU 14-736 Notes: Distributed Systems: Techniques, Infrastructure and Services"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2025-01-07T19:17:06.000Z"><meta property="article:modified_time" content="2025-03-11T20:34:04.139Z"><meta property="article:author" content="Bill Hu"><meta property="article:tag" content="Lecture Notes"><meta name="twitter:card" content="summary_large_image"><title>[Lecture Notes] CMU 14-736 Distributed Systems - Bill Hu&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/myfont.css"><link rel="stylesheet" href="/css/jetbrains-mono.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"www.billhu.us",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:25,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},gtag:null},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script>!function(t,e,n,c,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/fjnxcr4gva",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta name="google-site-verification" content="IqNfw3GiMxuhw7kYoEdhMJoh3j99KHuGI9bw00hPn2c"><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet"><meta name="generator" content="Hexo 7.1.1"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Bill Hu&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="https://www.billhu.xyz" target="_self"><i class="iconfont icon-code"></i> <span>Portfolio</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="[Lecture Notes] CMU 14-736 Distributed Systems"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2025-01-07 19:17" pubdate>January 7, 2025 pm</time></span></div><div class="mt-1"></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">[Lecture Notes] CMU 14-736 Distributed Systems</h1><div class="markdown-body"><h1 id="lec-1"><a class="markdownIt-Anchor" href="#lec-1"></a> Lec 1.</h1><p><strong>Distributed System</strong>: a collection of resources on distinct physical components that appear to function as a single coherent system.</p><h1 id="lec-2"><a class="markdownIt-Anchor" href="#lec-2"></a> Lec 2.</h1><p><strong>RPC</strong> (Remote Procedure Calls)</p><h1 id="lec-7-coordinator-selection"><a class="markdownIt-Anchor" href="#lec-7-coordinator-selection"></a> Lec 7. Coordinator Selection</h1><p>许多分布式系统需要一个coordinator（协调者）, 那么如何决定谁是coordinator?</p><p>两种基本策略：appointing (直接任命) 和投票选举</p><ul><li><p>Appointing a Coordinator</p><ul><li><p>人工指定available hosts中谁是管理员</p></li><li><p>优点：简单、不需要开发时间、灵活(agile)</p></li><li><p>缺点：与电脑相比人工很慢、人工必须能够检测到和理解failure</p></li></ul></li><li><p>Electing a Coordinator</p><ul><li>participants自己通过交流决定谁是coordinator</li><li>优点：自动</li><li>缺点：complexity, network traffic, failure mode can be complex</li></ul></li></ul><h2 id="assumptions"><a class="markdownIt-Anchor" href="#assumptions"></a> Assumptions</h2><p>大多数coordinator selection algorithms所做的假设：</p><ul><li>所有节点有唯一可比较的ID</li><li>每个节点知道其它所有节点的ID</li><li>节点通过超时等机制能够检测当前coordinator的故障（possibly incorrectly determine）</li><li>节点之间的通信是可靠的</li></ul><h2 id="bully-algorithm"><a class="markdownIt-Anchor" href="#bully-algorithm"></a> Bully Algorithm</h2><p>基本思想：当某个节点检测到coordinator故障时，会向其它所有ID比自己大的节点发送elect消息。</p><p>如果没有收到比自己更高ID节点的响应，才会宣布自己为新的coordinator（自己是可用节点中ID最高的）。</p><p>如果自己不是ID最高的，e.g. p1向p2 p3发送选举消息，则p2会向p1说no，并p2向外发出自己的选举消息。</p><p>优点：逻辑简单</p><p>缺点：节点数量较多时会产生大量选举消息</p><h2 id="invitation-algorithm"><a class="markdownIt-Anchor" href="#invitation-algorithm"></a> Invitation Algorithm</h2><p>针对网络分区设计，如果系统中有节点异常，相当于完整的网络整体被partition成了几个区，区之间能够通信但跨区的通信中断了。</p><p>出现网络分区时，各个分区内可以独立进行选举，形成分区内的coordinator，随后分区内的coordinator会定期互相联系，一旦发现对方也是coordinator，则会通过协商合并分区，选出统一的coordinator。，</p><p>优点：自愈能力；即使网络部分断连，各个分区依然可以继续工作</p><h2 id="ring-election"><a class="markdownIt-Anchor" href="#ring-election"></a> Ring Election</h2><p>将所有节点串成一个ring环形结构，每个节点只与下一个节点通信</p><p>某个节点检测到coordinator故障时，向下一个节点发送包含自身ID的ELECTION信息，接收到election信息的节点在消息中加入自己的ID继续传递，直到消息返回到起始节点</p><p>起始节点收集到所有节点ID后，选出其中最大的ID作为新的coordinator，并通过ring传递COORDINATOR消息宣布结果。</p><p>优点：消息复杂度较低</p><p>缺点：依赖于ring的稳定性，且同时可能出现多个并发选举进程</p><h2 id="apache-zookeeper"><a class="markdownIt-Anchor" href="#apache-zookeeper"></a> Apache ZooKeeper</h2><p>一个开源的distributed coordination service.</p><p>ZooKeeper中的选举算法是基于Bully算法的变体，不仅比较节点ID还会结合逻辑时间（或任务计数）</p><p>每个节点维护nextID和最新的逻辑时间T。nextID是节点认为会被下一个选举出来的coordinator的ID。</p><p>节点检测到coordinator失效时，会将nextID设为自己的ID，并记录当前逻辑时间，然后向别的节点发送election消息。</p><p>节点收到election消息时，会比较逻辑时间和ID，确保选出的coordinator是最新状态的节点。</p><p>最终一定会agree出一个coordinator，但是verification的过程较为复杂。</p><p>目标：防止选举出过时的节点 (bully with constraints)</p><h1 id="lec-8-concurrency"><a class="markdownIt-Anchor" href="#lec-8-concurrency"></a> Lec 8. Concurrency</h1><p>Recall: <strong>classical concurrency</strong></p><p>关键概念：</p><ul><li>race condition, mutual exclusion, critical section</li><li>semaphore, mutex, deadlock, producer-consumer problem</li></ul><p><strong>Distributed Concurrency</strong>主要有两大类：<strong>distributed coordination</strong> 和 <strong>Token-passing algorithms</strong></p><h2 id="1st-class-of-techniques-distributed-coordination"><a class="markdownIt-Anchor" href="#1st-class-of-techniques-distributed-coordination"></a> 1st class of techniques: distributed coordination</h2><p>基于消息队列的算法</p><ul><li><p>Lamport mutual exclusion</p><ul><li><p>维护一个distributed queue分布式队列，每个participant都有一份copy</p><p>当节点发送 REQUEST 消息给所有其他节点后，只有在自己请求处于本地队列头部且收到所有其他节点的 GRANT（或确认）消息后，才能进入critical section.</p><p>critical section运行完成后向其它所有participant发送RELEASE消息，以便其它节点更新队列</p><p>优点：全局顺序，即所有节点都按照相同的顺序处理请求</p><p>缺点：每次进入critical section需要 3(n-1) 条消息，开销大(n-1是因为不用给自己发送)；任一节点故障都会阻塞系统，fault tolerance不足</p></li></ul></li><li><p>Ricart-Agrawala Algorithm</p><ul><li><p>Lamport的扩展和优化，减小了消息的交互数量</p><p>请求者发送 REQUEST 消息后，其余节点在条件满足时直接回复 GRANT（延迟回复或队列处理待条件满足）</p><p>缺点：同样任一节点故障都会让系统starvation或deadlock，fault tolerance不足</p></li></ul></li><li><p>Majority Voting</p><ul><li><p>请求者向所有节点发送请求，只需获得超过半数节点的 GRANT 就能进入临界区</p><p>为解决并发请求冲突，引入了 INQUIRE（询问）和 RELINQUISH（放弃）消息机制来重新分配投票，确保不会出现死锁</p></li></ul></li><li><p>Voting Districts</p><ul><li>将整个系统划分为多个较小的“投票区域”（或称为 coteries），每个节点只与自己区域内的其他节点进行投票协商，最后通过局部胜出合成全局结果</li><li>典型结构包括网格结构，每个节点可能属于多个交叉的区域</li><li>优点：见啥消息传递数量（因为请求只需要在较小区域内完成）；fault tolerance可以容忍一半节点失效</li><li>缺点：split votes（多个并发请求可能导致票数分散）；投票区域的重叠增加复杂度</li></ul></li></ul><h2 id="2nd-class-of-techniques-token-passing-algorithms"><a class="markdownIt-Anchor" href="#2nd-class-of-techniques-token-passing-algorithms"></a> 2nd class of techniques: Token-passing algorithms</h2><ul><li><p>Implicit queueing</p><ul><li><p>每个节点维护一个 end-of-queue 指向队列末端的指针，以及指向下一个候选人的指针</p><p>请求时，节点将自己的请求加入队列只需要向end-of-queue发送REQUEST</p><p>critical section结束后，节点根据指针信息将token传递给队列中下一个候选人</p></li><li><p>优点：减少全局broadcast开销</p></li><li><p>缺点：队列结构容易受影响；恢复机制复杂（队列断裂后如何重构全局队列）</p></li></ul></li><li><p>Token ring</p><ul><li>让所有节点成环，token按照环的顺序传递，如果节点不需要token，则直接传递给下一个节点</li><li>优点：简单，内存需求低（每个节点只需要知道下一个节点）；延迟最坏情况O(N)</li><li>缺点：节点数量较多时开销较大；不提供FIFO可能导致不公平；需要额外的故障检测机制</li></ul></li><li><p>Raymond’s Algorithm</p><ul><li><p>构建dynamic tree，每个节点有一个父节点，树的root持有token</p><p>请求时，会将请求沿着树向上传递，最终由token holder响应</p><p>释放时，token会给队列中排队的第一个请求者，同时调整树中节点之间的父子关系</p></li><li><p>优点：平衡树中消息传递复杂度为 log N，比token ring的O(N)更高效</p></li><li><p>缺点：动态树容易受网络波动或节点故障而断裂；公平性不如FIFO因为局部分支的请求可能优先处理</p></li></ul></li></ul><h2 id="failure-of-resource-holder"><a class="markdownIt-Anchor" href="#failure-of-resource-holder"></a> Failure of resource holder</h2><p>不论采用哪种分布式互斥算法，都会面临一个共同的问题：<strong>resource holder fails</strong></p><p>例如，如果当前正持有token或正在执行临界区代码的节点突然失效，其他节点将无法获得资源，从而导致系统“堵塞”或死锁</p><p>常见策略包括 租约机制：为锁设置一个有效期（lease expiration time），如果持有者在租约到期前未释放锁，则其他节点可以认为该锁失效，从而重新发起锁申请。</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Lecture-Notes/" class="category-chain-item">Lecture Notes</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Lecture-Notes/" class="print-no-link">#Lecture Notes</a></div></div><div class="license-box my-3"><div class="license-title"><div>[Lecture Notes] CMU 14-736 Distributed Systems</div><div>https://www.billhu.us/2025/055_cmu_14736/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>Bill Hu</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>January 7, 2025</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <span>With </span><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <a href="/about" target="_blank" rel="nofollow noopener"><span>Bill Hu</span></a><div style="font-size:.85rem"><span id="timeDate">Loading days...</span> <span id="times">Loading time...</span><script src="/js/duration.min.js"></script></div></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>