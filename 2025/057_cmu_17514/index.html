<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Bill Hu"><meta name="keywords" content=""><meta name="description" content="CMU 17-514 Notes: Principles of Software Construction: Objects, Design, and Concurrency"><meta property="og:type" content="article"><meta property="og:title" content="[Lecture Notes] CMU 17-514 Software Construction"><meta property="og:url" content="https://www.billhu.us/2025/057_cmu_17514/index.html"><meta property="og:site_name" content="Bill Hu&#39;s Blog"><meta property="og:description" content="CMU 17-514 Notes: Principles of Software Construction: Objects, Design, and Concurrency"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.billhu.us/2025/057_cmu_17514/domain-model-eg.webp"><meta property="og:image" content="https://www.billhu.us/2025/057_cmu_17514/sequence-diagram-eg.webp"><meta property="og:image" content="https://www.billhu.us/2025/057_cmu_17514/behavioural-contract-eg.webp"><meta property="og:image" content="https://www.billhu.us/2025/057_cmu_17514/strategy-pattern-eg.webp"><meta property="og:image" content="https://www.billhu.us/2025/057_cmu_17514/design-practice.webp"><meta property="article:published_time" content="2025-01-16T19:17:06.000Z"><meta property="article:modified_time" content="2025-11-11T17:40:17.420Z"><meta property="article:author" content="Bill Hu"><meta property="article:tag" content="Lecture Notes"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.billhu.us/2025/057_cmu_17514/domain-model-eg.webp"><title>[Lecture Notes] CMU 17-514 Software Construction - Bill Hu&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.15.6/katex.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/myfont.css"><link rel="stylesheet" href="/css/jetbrains-mono.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"www.billhu.us",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:25,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},gtag:null},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script>!function(t,e,n,c,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/fjnxcr4gva",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta name="google-site-verification" content="IqNfw3GiMxuhw7kYoEdhMJoh3j99KHuGI9bw00hPn2c"><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet"><meta name="generator" content="Hexo 7.2.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Bill Hu&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="https://www.billhu.xyz" target="_self"><i class="iconfont icon-code"></i> <span>Portfolio</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="[Lecture Notes] CMU 17-514 Software Construction"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2025-01-16 19:17" pubdate>January 16, 2025 pm</time></span></div><div class="mt-1"></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">[Lecture Notes] CMU 17-514 Software Construction</h1><div class="markdown-body"><h1 id="lec-2-object-oriented-basics"><a class="markdownIt-Anchor" href="#lec-2-object-oriented-basics"></a> Lec 2. Object-Oriented Basics</h1><p>Tradeoffs?</p><ul><li>Version 1</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] list, String order)</span> &#123;<br>	<span class="hljs-comment">// ...</span><br>	<span class="hljs-type">boolean</span> mustswap;<br>	<span class="hljs-keyword">if</span> (order.equals(<span class="hljs-string">&quot;up&quot;</span>)) &#123;<br>		mustswap = list[i] &lt; list[j];<br>	&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (order.equals(<span class="hljs-string">&quot;down&quot;</span>)) &#123;<br>		mustswap = list[i] &gt; list[j];<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>Version 2</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] list, Comparator cmp)</span> &#123;<br>	<span class="hljs-comment">// ...</span><br>  <span class="hljs-type">boolean</span> mustswap;<br>	mustswap = cmp.compare(list[i], list[j]);<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Comparator</span> &#123;<br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span>;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UpComparator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparator</span> &#123;<br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> &#123; <span class="hljs-keyword">return</span> i &lt; j; &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DownComparator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparator</span> &#123;<br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> &#123; <span class="hljs-keyword">return</span> i &gt; j; &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Version 1: Shorter</p><p>Version 2: Expandable.</p><p>TypeScript is a <strong>superset</strong> of JavaScript because it allows for <strong>gradual migration from JS to TS</strong></p><ul><li>Design for <strong>Change</strong> (flexibility, extensibility, modifiability)</li><li>Design for Division of Labor</li><li>Design for Understandability</li></ul><p>Java <strong>Primitives</strong>: <code>int</code>, <code>long</code>, <code>byte</code>, <code>short</code>, <code>char</code>, <code>float</code>, <code>double</code>, <code>boolean</code>. 注意没有string！</p><p>JavaScript <strong>Primitives</strong>: <code>null</code>, <code>undefined</code>, <code>boolean</code>, <code>number</code>, <code>string</code>, <code>symbol</code>, <code>bigint</code></p><ul><li>Primitives are <strong>immutable</strong>, and <strong>passed by value</strong></li></ul><p><code>Object</code> is a <strong>non-primitive</strong> type.</p><hr><div class="note note-info"><p>以下是八股文，看完就忘</p></div><h2 id="subtype-polymorphism-dynamic-dispatch"><a class="markdownIt-Anchor" href="#subtype-polymorphism-dynamic-dispatch"></a> Subtype Polymorphism / Dynamic Dispatch</h2><p>An <strong>interface</strong> describes the API/way to interact with an object. It does NOT provide the implementation.</p><p>There can be <strong>multiple implementations of one interface</strong>. Multiple implementations can coexist.</p><p>Java: <strong>Classes implicitly have Interfaces</strong>. Prefer interfaces over class types</p><p>例如：<code>class PolarPoint implements Point</code></p><p><strong>Dynamic dispatch</strong> (in both Java and JavaScript): 用父类指针指向子类对象，调用方法, method is decided at runtime</p><p>Java: <strong>Static</strong> methods are global functions, only single copy exists; class provides only namespace. Java does not allow global functions outside of classes. Java中Static函数就是全局函数（java不允许class外的全局函数），class只作为命名空间。</p><p><strong>Dynamic dispatch的优点: Design for change</strong></p><ul><li>A user of an object does not need to know the object’s implementation, only its interface. 用户不需要知道实现，只需要知道Interface</li><li>All objects implementing the interface can be used interchangeably. 所有implement这个interface的Object可以互换使用</li><li>Allows flexible change (modifications, extensions, reuse) later without changing the client implementation, even in unanticipated contexts. 方便修改和重构</li></ul><p><strong>Why multiple implementations</strong></p><ul><li><p>Different performance: Choose implementation that works best for your use</p></li><li><p>Different behavior:</p><ul><li>Choose implementation that does what you want</li><li>Behavior must comply with interface spec (“contract”)</li></ul></li><li><p>Often performance and behavior both vary: Provides a functionality – performance tradeoff. Example: HashSet, TreeSet</p></li></ul><h2 id="encapsulation-information-hiding"><a class="markdownIt-Anchor" href="#encapsulation-information-hiding"></a> Encapsulation / Information hiding</h2><p><strong>Information hiding的优点</strong></p><ul><li><p><strong>Decouples</strong> the objects that comprise a system: Allows them to be developed, tested, optimized, used, understood, and modified in isolation</p></li><li><p><strong>Speeds up</strong> system development: Objects can be developed in parallel</p></li><li><p>Eases <strong>maintenance burden</strong>: Objects can be understood more quickly and debugged with little fear of harming other modules</p></li><li><p>Enables effective <strong>performance tuning</strong>: “Hot” classes can be optimized in isolation</p></li><li><p>Increases software <strong>reuse</strong>: Loosely-coupled classes often prove useful in other contexts</p></li></ul><p>How to hide information?</p><ul><li>Java中使用<code>private</code>（注意interface method must be <code>public</code>)</li><li>Declare variables using interface types, not class types<ul><li>client can use only interface methods. Fields and implementation-specific methods are not accessible from client code.</li></ul></li><li>JavaScript中使用闭包 <strong>closure</strong>, TypeScript中能直接private。</li><li>JavaScript中使用Modules能 information hiding at file level.</li></ul><h1 id="lec-3-object-oriented-analysis"><a class="markdownIt-Anchor" href="#lec-3-object-oriented-analysis"></a> Lec 3. Object-oriented Analysis</h1><p>如何把用户需求转变成代码实现？</p><p>Problem Space (Domain Model) ----&gt; Solution Space (Object model)</p><table><thead><tr><th>Problem Space (Domain Model)</th><th>Solution Space (Object Model)</th></tr></thead><tbody><tr><td>Real-world things</td><td>System Implementation</td></tr><tr><td>Requirements, concepts</td><td>Classes, objects</td></tr><tr><td>Relationships among concepts</td><td>References among objects and inheritance hierarchies</td></tr><tr><td>Solving a problem</td><td>Computing a result</td></tr><tr><td>Building a vocabulary</td><td>Finding a solution</td></tr></tbody></table><h2 id="domain-models"><a class="markdownIt-Anchor" href="#domain-models"></a> Domain Models</h2><p><strong>Object-Oriented Analysis</strong>: understanding the problem</p><ul><li><p><strong>domain model</strong></p></li><li><p>find key concepts in the problem domain</p><ul><li>找名词、动词、和concepts之间的relationships。避开不明确的词例如system。</li></ul></li><li><p>using <strong>UML (Unified Modeling Language)</strong> class diagrams as informal notation</p></li><li><p><strong>glossary</strong></p><ul><li>Identify and define key concepts. Ensure shared understanding between developers and customers.</li><li>例如: “Library Item: Any item that is indexed and can be borrowed from library.” 这句话对于可能有歧义的concepts给出了明确定义。</li></ul></li><li><p><strong>system sequence diagram</strong>: a model that shows, for one usage scenario, sequence of events that occur on the system’s boundary.</p></li><li><p>system behavioral contracts</p></li></ul><p><strong>OO Design</strong>: Defining a solution</p><ul><li>object interaction diagrams</li><li>object model</li></ul><p>Domain Model长这样</p><ul><li>空心菱形：aggregation 聚合关系，例如：<code>班级 ◇--- 学生</code>（学生可以存在于班级之外）</li><li>实心菱形：composition 组合关系，例如：<code>人 ♦--- 心脏</code>（心脏不能离开人体独立存在）</li><li>三角形：inheritance/generalization 继承/泛化关系，例如：<code>狗 ---△ 动物</code>（狗继承自动物）</li></ul><img src="/2025/057_cmu_17514/domain-model-eg.webp" srcset="/img/loading.gif" lazyload><p>UML Sequence Diagram 长这样</p><img src="/2025/057_cmu_17514/sequence-diagram-eg.webp" srcset="/img/loading.gif" lazyload><p>Behavioural Contract 长这样</p><img src="/2025/057_cmu_17514/behavioural-contract-eg.webp" srcset="/img/loading.gif" lazyload><p>完成了Domain Model, System Sequence Diagram 和 Behavioural Contract 之后，就是从Problem Space到Solution Space的转换。希望能low representational gap</p><h1 id="lec-4-responsibility-assignment"><a class="markdownIt-Anchor" href="#lec-4-responsibility-assignment"></a> Lec 4. Responsibility Assignment</h1><p>Problem Space (Domain model) —&gt; Solution Space (Object model)</p><p>Representational gap</p><h2 id="design-principle"><a class="markdownIt-Anchor" href="#design-principle"></a> Design Principle</h2><ul><li><p><strong>Low representational gap</strong></p><p>Domain concepts provide inspiration for software classes.</p><p>Classes for domain concepts intuitive to understand, rarely change.</p><p>为什么要low representational gap? 你可以建立一个class LibrarySystem然后把所有东西放在单个巨大的class里，但是这样不好做后续修改（我们需要 <strong>design for change</strong>）</p><p>Benefits</p><ul><li>facilitates understanding of design and implementation</li><li>facilitates traceability from problem to solution</li><li>facilitates evolution (<strong>design for change</strong>)</li></ul></li><li><p><strong>Low coupling</strong></p><p>A model should depend on as few other modules as possible</p><p>一个module要和尽量少的module之间有依赖关系</p><p>Benefits</p><ul><li><p>Enhances understanability</p></li><li><p>Reduce the cost of change (如果每个module最多只和另外两个module有关系，那么改变module时最多只需要修改两个module，不需要牵一发而动全身)</p></li><li><p>Enhances reuse (fewer dependencies, easier to adapt to a new context)</p></li></ul><p>A related design heuristic: <strong>law of demeter</strong>: <strong>each module should have only limited knowledge about other units</strong></p><p><code>a.getB().getC().foo</code> is a bad practice !!! This means you are not distributing knowledge correctly !!!</p><p><strong>Prefer coupling to interfaces</strong> over coupling to implementations (interface相比implementation改变得更少)</p></li><li><p><strong>High cohesion</strong> (or <strong>single-responsibility principle</strong>)</p><p>Each component should have a small set of closely-related responsibilities</p><p>每个component（每个class/object）只负责较少的职责</p><p>Benefits:</p><ul><li>facilitates understandability</li><li>facilitates reuse</li><li>eases maintenance</li></ul></li></ul><p><strong>Coupling vs Cohesion</strong></p><p>把所有代码写在一个class里：very low coupling, but very low cohesion.</p><p>把每个模块都分开来：very high cohesion, but very high coupling.</p><p>Find a good tradeoff!</p><h1 id="lec-5-inheritance-and-delegation"><a class="markdownIt-Anchor" href="#lec-5-inheritance-and-delegation"></a> Lec 5. Inheritance and Delegation</h1><p>Java中class的继承关系，所有class都继承自 <code>class Object</code></p><p>Java编译期判断which class to look in, method signature to be executed，运行时判断class的动态类型，对于动态class判断到底执行哪个method。</p><p>JavaScript运行时解析methods。</p><ul><li><p>Inheritance vs Subtyping</p><p><strong>Inheritance</strong>: <code>class A extends B</code></p><p><strong>Subtyping</strong>: <code>class A implements B</code>, <code>class A extends B</code></p></li></ul><h1 id="lec-6-design-patterns"><a class="markdownIt-Anchor" href="#lec-6-design-patterns"></a> Lec 6. Design Patterns</h1><p>“Each pattern describes a problem which occurs over and over again in our environment, and then describes the core of the solution to that problem, in such a way that you can use this solution a million times over, without ever doing it the same way twice.”</p><p>Design pattern是针对软件开发中反复出现的问题，总结出可复用、灵活解决方案的一种经验方法</p><h2 id="strategy-pattern"><a class="markdownIt-Anchor" href="#strategy-pattern"></a> Strategy Pattern</h2><p><strong>Problem</strong>: Clients need different variants of an algorithm</p><p><strong>Solution</strong>: Create an interface for the algorithm, with an implementing class for each variant of the algorithm</p><p><strong>Consequences</strong></p><ul><li>Easily extensible for new algorithm implementations.</li><li>Separates algorithm from client context</li><li>Introduces an extra interface and many classes: (1) code can be harder to understand, (2) lots of overhead if the strategies are simple.</li></ul><img src="/2025/057_cmu_17514/strategy-pattern-eg.webp" srcset="/img/loading.gif" lazyload><h2 id="template-method-design-pattern"><a class="markdownIt-Anchor" href="#template-method-design-pattern"></a> Template Method Design Pattern</h2><ul><li><p>Applicability</p><ul><li><p>When an algorithm consists of varying and invariant parts that must be customized</p></li><li><p>When common behavior in subclasses should be factored and localized to avoid code duplication</p></li><li><p>To control subclass extensions to specific operations</p></li></ul></li><li><p>Consequences</p><ul><li><p>Code reuse</p></li><li><p>Inverted “Hollywood” control: don’t call us, we’ll call you</p></li><li><p>Ensures the invariant parts of the algorithm are not changed by subclasses</p></li></ul></li></ul><p>Abstract class 抽象类，指一个class有些方法implement了有些方法没有implement</p><p><strong>Template Method vs Strategy Pattern</strong></p><ul><li>Template method uses <strong>inheritance</strong> to vary part of an algorithm</li><li>Strategy pattern uses <strong>delegation</strong> to vary the entire algorithm</li></ul><p><strong>Inheritance vs. Composition + Delegation</strong></p><ul><li><p>Inheritance can enable <strong>substantial</strong> reuse when strong coupling is reasonable</p><ul><li>Sometimes a natural fit for reuse – look for “is-a” relationships.</li><li>Does not mean “no delegation”</li></ul></li><li><p>That said, good design typically favors composition + delegation</p><ul><li><p>Enables reuse, encapsulation by programming against interfaces</p></li><li><p>Delegation supports information hiding; inheritance violates it</p></li><li><p>Usually results in more <em>testable</em> code.</p></li><li><p>Composition facilitates adding multiple behaviors, much less messily than multiple inheritance.</p></li></ul></li></ul><h2 id="composite-design-pattern"><a class="markdownIt-Anchor" href="#composite-design-pattern"></a> Composite Design Pattern</h2><ul><li><p>Applicability</p><ul><li><p>You want to represent part-whole hierarchies of objects</p></li><li><p>You want to be able to ignore the difference between compositions of objects and individual objects</p></li></ul></li><li><p>Consequences</p><ul><li><p>Makes the client simple, since it can treat objects and composites uniformly</p></li><li><p>Makes it easy to add new kinds of components</p></li><li><p>Can make the design overly general</p><ul><li><p>Operations may not make sense on every class</p></li><li><p>Composites may contain only certain components</p></li></ul></li></ul></li></ul><h2 id="module-pattern"><a class="markdownIt-Anchor" href="#module-pattern"></a> Module Pattern</h2><p>Hide internals in closure</p><h1 id="lec-7-design-practice"><a class="markdownIt-Anchor" href="#lec-7-design-practice"></a> Lec 7. Design Practice</h1><p>One more pattern called <strong>decorator pattern</strong>.</p><h2 id="decorator-pattern"><a class="markdownIt-Anchor" href="#decorator-pattern"></a> Decorator Pattern</h2><p>Inheritance的局限性：</p><p>e.g. 需要写一个<code>Stack</code>，有<code>UndoStack</code>, <code>SecureStack / LockedStack</code>（需要密码才能读stack）, <code>SynchronizedStack</code> （concurrent-safe）</p><p>还要能将上面这些结合起来，有<code>SecureUndoStack</code>, <code>SynchronizedUndoStack</code>, <code>SecureSynchronizedStack</code>等等 （arbritrarily composable extensions）</p><p>Decorator Pattern: <strong>add functionality at runtime</strong></p><p>Decorator Pattern is good if you want to <strong>arbitrarily combine/add features to a class</strong>.</p><img src="/2025/057_cmu_17514/design-practice.webp" srcset="/img/loading.gif" lazyload><div class="note note-info"><p>以下是八股</p></div><p>Problem: Responsibilities should be added to an object dynamically at runtime.</p><p>Solution: Defines a Decorator object that implements the interface of an extended object, optionally performing additional functionality before/after forwarding the request.</p><ul><li>Applicability<ul><li>add responsibilities to individual objects dynamically and transparently</li><li>for responsibilities that can be withdrawn</li><li>when extension by subclassing is impractical</li></ul></li><li>Consequences<ul><li>more flexible than static inheritance</li><li>avoids large classes in the hierarchy</li><li>lots of little objects</li></ul></li></ul><h1 id="lec-8-refactoring-antipattern"><a class="markdownIt-Anchor" href="#lec-8-refactoring-antipattern"></a> Lec 8. Refactoring antipattern</h1><p>Detour: object equality</p><ul><li><p>比较primitive object (<code>Object.isPrimitives</code>) 可以使用 <code>==</code>.</p></li><li><p>比较其它object需要使用 <code>.equals</code> 不能使用 <code>==</code></p></li><li><p><code>Object.equals()</code>可以永远返回false，这是合法的，<code>null</code>和所有东西equal都是false</p></li></ul><p>Hashcode</p><ul><li>equal的object必须有equal hashcode。否则会出现奇怪的bug，例如Hashmap, Hashset无法正常运行</li><li>generally necessary to override the <code>hashCode</code> method whenever this method is overridden.</li><li>hashcode 可以返回0，但会让搜索变得很低效</li></ul><p>Override <code>Object</code> implementations</p><ul><li>No need to override <code>equals</code> and <code>hashCode</code> if you want identity semantics</li><li>Nearly always override <code>toString</code></li></ul><h2 id="refactoring-functionality-preserving-rewriting"><a class="markdownIt-Anchor" href="#refactoring-functionality-preserving-rewriting"></a> Refactoring: Functionality-preserving rewriting</h2><p>Functionality-preserving restructuring: <strong>semantics</strong> of the program <strong>do not change</strong>, but the <strong>syntax change</strong></p><p>通常来说如果functionality is correct, but organization is bad (e.g. high coupling, high redundancy, poor cohesion, god classes…) 则需要refactoring</p><h2 id="anti-patterns"><a class="markdownIt-Anchor" href="#anti-patterns"></a> Anti-Patterns</h2><p>Anti-patterns are common forms of bad design</p><p>Two common causes</p><ul><li>design issues that manifest as bad/unmaintainable code</li><li>poorly written/evolved code that leads to bad design</li></ul><p>Code smells</p><ul><li>不一定不好，但需要一些检查</li><li>例如<ul><li>long methods, large classes. Suggests bad abstraction</li><li>inheritance despite low coupling (“refused bequest”) --&gt; replace with delegation or rebalance hierarchy</li><li><code>instanceOf</code> or <code>switch</code> instead of <strong>polymorphism</strong><ul><li><strong>avoiding <code>instanceOf</code></strong></li><li>Do not ask an object’s type, ask an object to do something</li><li>使用subtype polymorphism (interfaces)代替，因为这只需要改一处，instanceOf需要改很多处</li><li>仅在不可避免时使用instanceOf, 例如 <code>equals()</code> 要求 Obejct type vs <code>Comparator&lt;T&gt;</code></li></ul></li><li>overly similar classes, hierarchies</li><li>any change requires lots of edits (high coupling across classes, or heavily entangled implementation)</li><li>excessive, unused hierarchies</li><li>operations posing as classes</li><li>data classes (not always bad, but ideally distinguish from regular classes (record), and assign responsibilities if any exist)</li><li>heavy usage of one class data from another (poor coupling)</li><li>long chains of calls</li><li>a class that only delegates work</li></ul></li></ul><h2 id="fluent-apis-builder-design-pattern"><a class="markdownIt-Anchor" href="#fluent-apis-builder-design-pattern"></a> Fluent APIs / Builder Design Pattern</h2><p><strong>Liquid APIs</strong>: each method changes state, then returns <code>this</code> (对于Immutable则return modified copy)</p><p>e.g. <code>Option find = OptionBuilder.withArgName(&quot;file&quot;).hasArg().withDescription(&quot;search...&quot;).create(&quot;find&quot;)</code></p><p>Builder Pattern: 当创建一个complex object的许多个变种时，</p><p>e.g. <code>HouseBuilder.buildWalls().buildDoors().buildGarage().getResult()</code></p><ul><li><p>assign assembling work to a builder object</p><p>when cascading, builder returns itself, modified on every update</p><p>offers a method that generates the resulting object</p></li><li><p>引导使用者 <strong>only use the Builder</strong></p><p>e.g. make the constructor private</p></li></ul><p>Fludent APIs的优缺点</p><ul><li>Advantages<ul><li>fairly readable code</li><li>can check individual arguments</li><li>avoid untyped complex arguments</li></ul></li><li>Disadvantages<ul><li>runtime error checking of constraints and mandatory arguments</li><li>extra complexity</li><li>not always obvious how to terminate</li><li>possibly harder to debug</li></ul></li></ul><h2 id="iterator-pattern-streams"><a class="markdownIt-Anchor" href="#iterator-pattern-streams"></a> Iterator Pattern &amp; Streams</h2><p>从Java 1.5开始</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Iterator</span>&lt;E&gt; &#123;<br>	<span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span>;<br>	E <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;<br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以显式使用iterator</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Iterator&lt;String&gt; it = a.iterator(); it.hasNext();) &#123;<br>	<span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> it.next();  <span class="hljs-comment">// do something</span><br>&#125;<br></code></pre></td></tr></table></figure><p>也可以使用 <code>for (String s : arguments)</code></p><p>Iterators for everything, 例如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pair</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterable</span>&lt;E&gt; &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> E first, second;<br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pair</span><span class="hljs-params">(E f, E s)</span> &#123; first = f; second = s; &#125;<br>  <span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PairIterator</span>();<br>  &#125;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PairIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;E&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">seenFirst</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>, seenSecond = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span>  <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> !seenSecond; &#125;<br>    <span class="hljs-keyword">public</span>  E <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">if</span> (!seenFirst)  &#123; seenFirst  = <span class="hljs-literal">true</span>; <span class="hljs-keyword">return</span> first;  &#125;<br>      <span class="hljs-keyword">if</span> (!seenSecond) &#123; seenSecond = <span class="hljs-literal">true</span>; <span class="hljs-keyword">return</span> second; &#125;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();<br>  &#125;<br>&#125;<br><span class="hljs-comment">// Usage:</span><br>Pair&lt;String&gt; pair = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pair</span>&lt;String&gt;(<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;bar&quot;</span>);<br><span class="hljs-keyword">for</span> (String s : pair) &#123; ... &#125;<br></code></pre></td></tr></table></figure><p><strong>Iterator design pattern</strong></p><ul><li>Problem: Client需要一个统一的访问container所有元素的strategy。顺序unspecified，但访问所有元素一次。</li><li>Solution: A strategy pattern for iteration</li></ul><p>Streams</p><ul><li><p>typically provide operations to produce new stream from old stream (e.g. map, flatMap, filter) and operations on all elements (fold, sum)</p></li><li><p>often has efficient/parallel implementations (subtype polymorphism)</p></li><li><p>Java8开始自带</p></li><li><p>e.g.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt;results = stream.map(Object::toString)<br>                .filter(s -&gt; pattern.matcher(s).matches())<br>                .collect(Collectors.toList());<br><span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> numbers.parallelStream().reduce(<span class="hljs-number">0</span>, Integer::sum);<br></code></pre></td></tr></table></figure></li></ul><h1 id="lec-9-specifications-unit-testing"><a class="markdownIt-Anchor" href="#lec-9-specifications-unit-testing"></a> Lec 9. Specifications &amp; Unit-testing</h1><p>Contracts需要定义preconditions和postconditions</p><ul><li><p>如果precondition未满足则client is to blame</p></li><li><p>如果postcondition未满足则service is to blame</p></li><li><p>error behaviors (if preconditions is not met) should also be specified.</p></li></ul><p>Most real-world code has a contract</p><ul><li>service implementation is hidden from service client</li><li>client environment is hidden from service provider</li><li>explicit is much better than implicit when it comes to quality assurance<ul><li>exception handling, unit testing, specifications</li></ul></li></ul><h2 id="exceptions"><a class="markdownIt-Anchor" href="#exceptions"></a> Exceptions</h2><p>Separate all error handling away from the main code</p><p>Where do exceptions come from?</p><ul><li>program can raise them explicitly using throw</li><li>underlying JVM can generate them</li></ul><p>Exception handling: <strong>undeclared</strong> vs <strong>declared</strong> (<code>throws IOException</code>)</p><p>Checked exception</p><ul><li>Must be caught or propagated, or program won’t compile</li><li>exceptional condition that programmer must deal with</li></ul><p>Unchecked exception</p><ul><li>no action is required for program to compile (but will cause runtime failure)</li><li>usually indicates a programming error</li><li>common: all exceptions in C++, JS</li></ul><p>Error</p><ul><li>special unchecked exception typically thrown by VM</li><li>recovery is usually impossible (e.g. <code>StackOverflowError</code>)</li></ul><p><strong>Benefits of exceptions</strong></p><ul><li>easier to make sure you handle common failure modes<ul><li>explicit, rather than implicit, error-handling</li><li>compare to using a flag or a special return value</li></ul></li><li>provide high-level summary of error</li><li>improve code structure<ul><li>separate normal code path from exceptional</li><li>error handling code is segregated in catch blocks</li></ul></li><li>ease task of writing robust, maintainable code</li></ul><p>Guidelines for using exceptions</p><ul><li>document all exceptions thrown by each method. 包括unchecked和checked。 但不要declare unchecked exceptions</li><li>include failure-capture info in detail message</li><li>don’t ignore exceptions</li><li>clean up. Solution: <strong>try-with-resources</strong></li></ul><h1 id="lec-10-test-case-design"><a class="markdownIt-Anchor" href="#lec-10-test-case-design"></a> Lec 10. Test case design</h1><p>给定一个method, 我们需要test什么</p><ul><li>What it claims to do --&gt; <strong>specification testing</strong> – the contract<ul><li>Test soly based on specification</li><li>Ignores implementation, use inputs/outputs only</li><li>Cover all specified behavior</li><li>Do not rely on code. Consider edge-cases of the specification, not the implementation. (Think like an attacker)</li></ul></li><li>What it does --&gt; <strong>structural testing</strong><ul><li>explicitly consider the implementation</li><li>optimize for various kinds of code coverage (line, stmt, branch, etc)</li></ul></li></ul><p>怎么写specifications?</p><ul><li>Formal frameworks can be used to describe pre- and post-conditions<ul><li>e.g. requires arr != null</li><li>rarely used</li></ul></li><li>More common: <strong>textual specification</strong> contracts</li><li>Preconditions</li><li>Postconditions<ul><li>Exceptional behaviour: 如果违反preconditions会发生什么</li></ul></li><li>Document: every parameter, return value, every exception, what the method does<ul><li>Do not document implementation details.</li></ul></li></ul><h2 id="contracts"><a class="markdownIt-Anchor" href="#contracts"></a> Contracts</h2><p>A contract is an agreement between an object and its user.</p><p>Defines the method’s and caller’s responsibilities.</p><p>What the method does, not how it does it (interface/API, not implementation)</p><h2 id="specification-based-testing"><a class="markdownIt-Anchor" href="#specification-based-testing"></a> Specification-based Testing</h2><p>When writing specification-based tests, ignore the implementation. 针对某个method写specification测试时要忽略method内部的实现。</p><p><strong>Boundary value testing</strong>: select a nominal/normal case, a boundary value, and an abnormal case.</p><p><strong>Equivalence class testing</strong>: if you cannot try every single value, group them where you expect similarities, select one representative each.</p><p>Decision Tables: we need a strategy to identify plausible mistakes.</p><h2 id="structural-testing"><a class="markdownIt-Anchor" href="#structural-testing"></a> Structural Testing</h2><p>Use the code itself as a guide for writing tests.</p><p><strong>Path coverage</strong> is impossible in the general case (当有loop的时候，有无穷中可能路径)</p><p>Instead, we approx by choosing sets of control flow paths through the program to cover instead.</p><p>You typically have both code &amp; (prose) specification.</p><p>Coverage is useful, but 不能替代insight.</p><h2 id="test-doubles"><a class="markdownIt-Anchor" href="#test-doubles"></a> Test doubles</h2><ul><li><p>Dummy (例子: 某个method什么都不做)</p><ul><li>Objects needed by the program (e.g. parameters) but are never actually used.</li><li>Used to improve performance and test isolation, or remove the need for complicated test scaffolding</li></ul></li><li><p>Stub</p><ul><li><p>Double for a real collaborator that gives predefined answers to calls during testing.</p></li><li><p>Used to improve performance and test isolation, or to test the system under certain conditions (e.g., unauthenticated user, exceptional cases).</p></li><li><p>人造的class返回预先规定好的数据</p></li></ul></li><li><p>Fake</p><ul><li>Provides an optimized, thinned-down version of a collaborator that replicates the same behavior of the original object without certain side effects or consequences.</li><li>Fully functional class with simplified implementation e.g. 内存数据库</li></ul></li><li><p>Spy</p><ul><li>Used to track and test the secret internal state of a collaborator. Monitors calls to the collaborator to track the internal state of that collaborator.</li><li>用于跟踪对对象方法的调用，进而跟踪一个collaborator的internal state</li></ul></li><li><p>Mock</p><ul><li><p>Used to test for <strong>expected interactions</strong> with a collaborator (i.e., method calls).</p><p>Can behave like a <em>spy</em>, a <em>stub</em>, or both.</p></li><li><p>instrumented variant of real class with fine-grained control</p></li></ul></li></ul><p>How test doubles help</p><ol><li><p>Speed: simulate response without going through the API</p></li><li><p>Stability: guaranteed deterministic return, reduces flakiness</p></li><li><p>Coverage: reliably simulate problems (e.g., return 404)</p></li><li><p>Insight: expose internal state</p></li><li><p>Development: presume functionality not yet implemented (e.g., test parts that</p><p>rely on payment processing without implementing the payment system)</p></li></ol><p>Test double cheatsheet</p><ul><li><p><strong>Dummy</strong> isn’t used very often</p></li><li><p><strong>Stub</strong> if you just want collaborators to provide canned responses</p></li><li><p><strong>Mock</strong> if you want to test interactions</p></li><li><p><strong>Spy</strong> if you want to track the hidden internal state, or if mocks become too complex</p></li><li><p><strong>Fake</strong> if you test a complex scenario that relies on a service or component that’s unavailable or unusable for your test’s purposes, and stubbing does not do the job</p></li></ul><h1 id="lec-11-testability"><a class="markdownIt-Anchor" href="#lec-11-testability"></a> Lec 11. Testability</h1><h2 id="command-query-separation"><a class="markdownIt-Anchor" href="#command-query-separation"></a> Command query separation</h2><p>Object methods可分为<strong>commands</strong>或<strong>queries</strong></p><p>query返回关于system states的信息，没有side effects</p><p>commands会改变system的state，但不会返回结果</p><ul><li><strong>Testing queries is easy</strong> because we only care about responses.<ul><li>Stubs and fakes often suffice 足够</li></ul></li><li><strong>testing commands is harder</strong>: needs to verify expected outcome by looking for effects on the system<ul><li>Spies and mocks</li></ul></li></ul><h2 id="design-principles-for-testable-code-solid"><a class="markdownIt-Anchor" href="#design-principles-for-testable-code-solid"></a> Design principles for testable code: SOLID</h2><ul><li><p><strong>Single responsibility principle (SRP)</strong></p><ul><li>Tests should have only a single reason to fail.</li></ul></li><li><p><strong>Open-closed principle (OCP)</strong></p><ul><li>designs should open for extension but closed for modification.</li><li>你的设计应该允许不改变源码的情况下extend一个class</li><li>generally, composition 比 inheritance要好</li><li></li></ul></li><li><p><strong>Liskov substitution principle (LSP)</strong></p><ul><li>subclasses should always be substitutable for their base classes</li><li>如果遵守LSP则 tests should not have unpleasant surprises resulting from abuse of inheritance.</li><li><em>Test doubles are created using LSP</em><ul><li>If the test double and real class implement or extend the same superclass, they can be substituted for superclass in any context that expects the superclass</li></ul></li><li>Class hierarchies that follow LSP contribute to testability by enabling the use of contract tests<ul><li>Tests written for an interface can be executed against all implementations of that interface</li></ul></li></ul></li><li><p><strong>Interface segregation principle (ISP)</strong></p><ul><li><p>small interfaces improve testability by making it easier to write and use test doubles</p></li><li><p>e.g. One test might want to stub collaborator A, fake collaborator B, and substitute a spy for collaborator C. With each collaborator having its own small interface, it’s straightforward to implement the test doubles!</p></li></ul></li><li><p><strong>Dependency inversion principle (DIP)</strong></p><ul><li>Complex high-level elements should not directly depend on low-level elements that are likely to change: instead both should depend on abstractions.</li><li>Abstractions should not depend on details; details should depend on abstractions.</li></ul></li></ul><p>Invocation/Observation</p><ul><li>invocation: private方法，not accessible to test classes.</li><li>observation: void methods with no return value. Internal state not visible to clients. 内部state的变化，会有side effects但无法测试</li></ul><h1 id="lec-12-intro-to-concurrency"><a class="markdownIt-Anchor" href="#lec-12-intro-to-concurrency"></a> Lec 12. Intro to concurrency</h1><p>Concurrency: 同一时刻多个threads一起运行 (not necessarily executing in parallel)</p><p>Asynchrony: computation happening outside the main flow</p><h2 id="threads"><a class="markdownIt-Anchor" href="#threads"></a> Threads</h2><p>Basic threading in java:</p><p><code>java.lang.Runnable</code>表示一个task: <code>public interface Runnable &#123; void run(); &#125;</code></p><p><code>java.lang.Thread</code>能在一个thread里运行<code>task</code></p><p><code>public class Thread &#123; public Thread(Runnable task); public void start(); public void join();&#125;</code></p><h2 id="concurrency"><a class="markdownIt-Anchor" href="#concurrency"></a> Concurrency</h2><p>multi-threading required for scalability and performance.</p><p>e.g Concurrency with file IO</p><p>Note: concurrency is not parallelism.</p><h3 id="concurrency-hazards"><a class="markdownIt-Anchor" href="#concurrency-hazards"></a> Concurrency hazards</h3><ul><li><p><strong>Safety hazards</strong></p><ul><li><p>shared mutable state requires synchronization</p></li><li><p><strong>thread safe</strong>: no assumptions required to operate correctly with multiple threads</p></li><li><p>Simple solution: Don’t have state, Don’t have shared state, Don’t have shared mutable state.</p><p>Ensure security of any mutable components</p></li><li><p>Immutability 有优点有缺点，缺点: trivial mutations might require copying a large object.</p></li></ul></li><li><p><strong>Liveness</strong> hazards</p><ul><li>eventually make progress</li></ul></li><li><p><strong>Performance</strong> hazards</p><ul><li>quickly make progress</li></ul></li></ul><h1 id="lec-13-concurrency-and-hazards"><a class="markdownIt-Anchor" href="#lec-13-concurrency-and-hazards"></a> Lec 13. Concurrency and Hazards</h1><h1 id="lec-14-java-parallelism"><a class="markdownIt-Anchor" href="#lec-14-java-parallelism"></a> Lec 14. Java Parallelism</h1><h2 id="waitnotify"><a class="markdownIt-Anchor" href="#waitnotify"></a> wait/notify</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHouse</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">pizzaArrived</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eatPizza</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>)&#123;<br>            <span class="hljs-keyword">while</span>(!pizzaArrived)&#123;<br>                wait();<br>						&#125;<br>            System.out.println(<span class="hljs-string">&quot;yumyum..&quot;</span>);<br>        &#125;<br>		&#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pizzaPerson</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>)&#123;<br>     			<span class="hljs-built_in">this</span>.pizzaArrived = <span class="hljs-literal">true</span>;<br>     			notifyAll();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Never invoke <code>wait</code> outside of a loop!</p><ul><li>loop tests the condition before and after waiting.</li><li>Before - skips wait if the condition already holds (needed to ensure liveness, otherwise thread can wait forever)</li><li>After - ensures safety (condition may not be true once a thread wakes up)</li></ul><h1 id="lec-15-concurrency-asynchrony-in-typescript"><a class="markdownIt-Anchor" href="#lec-15-concurrency-asynchrony-in-typescript"></a> Lec 15. Concurrency &amp; Asynchrony in TypeScript</h1><p><strong>JavaScript Engine</strong>: 两个主要组成部分: memory heap, call stack</p><p><strong>JavaScript Runtime</strong>: Engine + <strong>Web APIs, event loop, callback queue</strong></p><p>JavaScript is <strong>single-threaded</strong> (<strong>single call stack</strong>). Solution: <strong>Callbacks</strong></p><p><strong>Callback Hell</strong>: every callback takes an argument that is a result of the previous callbacks.</p><p>Solution: <strong>Promises</strong>, <strong>Async functions</strong></p><p>The <strong>Promise Pattern</strong>:</p><ul><li>Problem: one or more values we need will arrive later. (某个时刻必须要等待)</li><li>Solution: an abstraction for expected values</li><li>promise内有一个函数, 会被constructor立即调用, 传入<code>resolve</code> 和 <code>reject</code> 两个callback函数</li><li>完成后才会执行 <code>then</code> 和 <code>catch</code> callback. Callback永远会被invoke.</li></ul><p><strong>async/await</strong></p><ul><li><code>async</code> keyword can be placed before a <code>function</code>.</li><li>Async functions always returns a <code>Promise</code> (automatically). May return rejected promises on exceptions.</li></ul><p>Callback and Promises can make for messy exception handling and control flow</p><ul><li>multiple <code>catch</code>es and <code>then</code> s are hard to understand.</li><li>completely different error handling for sync &amp; async failures</li><li>making control flow based on result of a callback ends up creating more nesting</li></ul><h1 id="lec-16-more-patterns"><a class="markdownIt-Anchor" href="#lec-16-more-patterns"></a> Lec 16. More Patterns</h1><h2 id="observer-pattern"><a class="markdownIt-Anchor" href="#observer-pattern"></a> Observer Pattern</h2><p><strong>Publish/subscribe</strong>: a new mechanism that allows objects to subscribe to events they are interested in. Allows the publisher to notify all subscribers when an event happens.</p><p>Observer Pattern:</p><ul><li>Problem: Clients need to be able to implement a publish/subscribe mechanism.</li><li>Solution: Create a publisher class that maintains a list of Subscribers. This class should have methods to subscribe and unsubscribe, and also a method to notify all subscribers.</li><li>Consequences:<ul><li>Easy to add new subscriber classes without modifying the publishers code</li><li>Establishes relationships between objects at runtime</li><li>Subscribers are notified in a random order.</li></ul></li></ul><h2 id="proxy-design-pattern"><a class="markdownIt-Anchor" href="#proxy-design-pattern"></a> Proxy Design Pattern</h2><ul><li>Problem: You want to control client access to an object</li><li>Solution: Create a new Proxy class with the same interface as the original object. Update your app to pass the proxy object instead of the original object.</li><li>Consequences:<ul><li>You can control the object without clients knowing about it</li><li>You can manage the lifecycle of an object if clients don’t care</li><li>It can work even if the service isn’t available anymore</li><li>You can introduce new proxies without changing client code</li><li>Code can become more complicated with the introduction of new classes.</li></ul></li><li>Example: caching; caching and failover; redirect to local service</li></ul><h2 id="adapter-design-pattern"><a class="markdownIt-Anchor" href="#adapter-design-pattern"></a> Adapter Design Pattern</h2><p>Applicability</p><ul><li>You want to use an existing class, and its interface doesn’t match the one you need</li><li>You want to create a reusable class that cooperates with unrelated classes that don’t necessarily have compatible interfaces</li><li>You need to use several subclasses, but it’s practical to adapt their interface by subclassing each one.</li></ul><p>Consequences:</p><ul><li>exposes the functionality of an object in another form</li><li>unifies the interfaces of multiple incompatible adaptee objects</li><li>Lets a single adapter work with mutiple adaptees in a hierarchy</li><li>—&gt; low coupling, high cohesion</li></ul><h1 id="lec-17-intro-to-gui"><a class="markdownIt-Anchor" href="#lec-17-intro-to-gui"></a> Lec 17. Intro to GUI</h1><p>HTML</p><p>Static/Dynamic website</p><p><strong>Model-View-Controller (MVC)</strong> pattern</p><ul><li>Model: manage data related to the application domain</li><li>Controller: manage inputs from user: mouse, keyboard, menu, etc.</li><li>View: manage display of information on the screen</li></ul><h1 id="lec-18-libraries-and-frameworks"><a class="markdownIt-Anchor" href="#lec-18-libraries-and-frameworks"></a> Lec 18. Libraries and Frameworks</h1><p>Reuse at scale</p><p><strong>Terminology</strong></p><ul><li><strong>Library</strong>: A set of classes and methods that provide reusable functionality<ul><li>client controls library; library executes the call and returns data</li></ul></li><li><strong>Framework</strong>: reusable skeleton code that can be customized into an application<ul><li>Framework calls back into client code ==&gt; The Hollywood principle: “Don’t call use. We’ll call you.”</li></ul></li><li><strong>API</strong>: Application Programming Interface, the interface of a library or framework</li><li><strong>Client</strong>: the code that uses API</li><li><strong>Plugin</strong>: client code that customizes a framework</li><li><strong>extension point</strong>: a place where a framework supports extension with a plugin</li><li><strong>protocol</strong>: the expected sequence of interactions between the API and the client</li><li><strong>callback</strong>: a plugin method that the framework will call to access customized functionality</li><li><strong>lifecycle method</strong>: a callback method that gets called in a sequence according to the protocol and the state of the plugin.</li></ul><h2 id="white-box-vs-black-box-frameworks"><a class="markdownIt-Anchor" href="#white-box-vs-black-box-frameworks"></a> White-box vs Black-box frameworks</h2><p><strong>Whitebox (inheritance-based) frameworks</strong></p><ul><li>extension by <strong>subclassing</strong> and overriding methods. Subclass has main method but gives control to framework</li><li>common design patterns: template method</li></ul><p><strong>Blackbox (delegation-based) frameworks</strong></p><ul><li>extension by implementing a plugin interface. Plugin-loading mechanism loads plugins and gives control to the framework</li><li>common design patterns: strategy, observer</li></ul><p>Summary</p><ul><li>Whitebox frameworks use subclassing<ul><li>allows extension of every (non-private) method</li><li>need to understand implementation of superclass</li><li>only one extension at a time</li><li>compiled together</li><li>often so-called developer frameworks</li></ul></li><li>Blackbox frameworks use composition<ul><li>allows extension of functionality exposed in interface</li><li>only need to understand the interface</li><li>multiple plugins</li><li>often provides more modularity</li><li>separate deployment possible (.jar, .dll)</li><li>often so-called end-user frameworks, platforms</li></ul></li></ul><h1 id="lec-19-api-1"><a class="markdownIt-Anchor" href="#lec-19-api-1"></a> Lec 19. API 1</h1><p><strong>API Naming</strong></p><ul><li>makes client code: easy to read; mean what it says; easy to write</li><li>names should: be self-explanatory; leverage existing knowledge; interact with both the traget language and other APIs</li></ul><p>Names can be <strong>literal</strong> or <strong>metaphorical</strong></p><ul><li>literal names have literal associations</li><li>metaphorical names enable reasoning by analogy</li></ul><p>Use <strong>consistent terminology</strong> throughout your API</p><ul><li>never use same word for multiple meanings; never use multiple words for the same meaning</li><li>choose a structure and stick with it (e.g. createElement vs elementCreate)</li></ul><p>Avoid abbreviations</p><p>Don’t lie about what your methods do</p><ul><li>do not violate the <strong>principle of least astonishment</strong> (大多数人怎么认为)</li></ul><p><strong>API Documentation</strong></p><p>Document every method/function, parameter, exception thrown by each thread, every type</p><p>How to <strong>document a method</strong>: preconditions, postconditions, side-effects, thread-safety</p><p>How to <strong>document a parameter or field</strong>: describe what the parameter represents (短名词句), units, form, restrictions</p><p>How to <strong>document a method’s exceptions</strong>: say precisely when it is thrown. If not a precondition viiolation, say what the caller can do in response. Document all exceptions</p><h1 id="lec-20-api-2"><a class="markdownIt-Anchor" href="#lec-20-api-2"></a> Lec 20. API 2</h1><p>Hyrum’s Law: with a sufficient number of users of an API, it does not matter what you promise in the contract: all observable behaviors of your system will be depended on by somebody.</p><h1 id="lec-21-supply-chain-security-and-sustainability"><a class="markdownIt-Anchor" href="#lec-21-supply-chain-security-and-sustainability"></a> Lec 21. Supply Chain Security and Sustainability</h1><p>Think carefully about your dependencies</p><h1 id="lec-22-designing-and-testing-for-robustness-in-large-distributed-system"><a class="markdownIt-Anchor" href="#lec-22-designing-and-testing-for-robustness-in-large-distributed-system"></a> Lec 22. Designing and Testing for Robustness in Large &amp; Distributed System</h1><h1 id="lec-24-devops"><a class="markdownIt-Anchor" href="#lec-24-devops"></a> Lec 24. DevOps</h1></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Lecture-Notes/" class="category-chain-item">Lecture Notes</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Lecture-Notes/" class="print-no-link">#Lecture Notes</a></div></div><div class="license-box my-3"><div class="license-title"><div>[Lecture Notes] CMU 17-514 Software Construction</div><div>https://www.billhu.us/2025/057_cmu_17514/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>Bill Hu</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>January 16, 2025</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2025/056_cmu_14740/" title="[Lecture Notes] CMU 14-740 Fundamentals of Telecommunication Networks"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">[Lecture Notes] CMU 14-740 Fundamentals of Telecommunication Networks</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/2025/054_cmu_15618/" title="[Lecture Notes] CMU 15-618 Parallel Computer Architecture &amp; Programming"><span class="hidden-mobile">[Lecture Notes] CMU 15-618 Parallel Computer Architecture &amp; Programming</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <span>With </span><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <a href="/about" target="_blank" rel="nofollow noopener"><span>Bill Hu</span></a><div style="font-size:.85rem"><span id="timeDate">Loading days...</span> <span id="times">Loading time...</span><script src="/js/duration.min.js"></script></div></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>