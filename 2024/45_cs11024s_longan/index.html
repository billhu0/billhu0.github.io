<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Bill Hu"><meta name="keywords" content=""><meta name="description" content="非官方 CS110 Spring 2024 Longan Nano 指南"><meta property="og:type" content="article"><meta property="og:title" content="CS110 Longan Nano 配置与使用"><meta property="og:url" content="https://www.billhu.us/2024/45_cs11024s_longan/index.html"><meta property="og:site_name" content="Bill Hu&#39;s Blog"><meta property="og:description" content="非官方 CS110 Spring 2024 Longan Nano 指南"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://toast-lab.sist.shanghaitech.edu.cn/courses/CS110@ShanghaiTech/Spring-2023/labs/lab12/Lab%2012%20-%20Computer%20Architecture%20I%20-%20ShanghaiTech%20University_files/nano.png"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/ide-noplatformio-sense.jpg"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/vscode-platformioide-plugin.webp"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/vscode-21.jpg"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/vscode-build.webp"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/firmware-location.webp"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/troubleshoot-nokit.jpg"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/troubleshoot-httpclienterror.jpg"><meta property="og:image" content="https://www.billhu.us/2024/45_cs11024s_longan/troubleshoot-permission.jpg"><meta property="article:published_time" content="2024-05-14T00:42:05.000Z"><meta property="article:modified_time" content="2025-02-15T23:36:40.547Z"><meta property="article:author" content="Bill Hu"><meta property="article:tag" content="C"><meta property="article:tag" content="Lecture Notes"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://toast-lab.sist.shanghaitech.edu.cn/courses/CS110@ShanghaiTech/Spring-2023/labs/lab12/Lab%2012%20-%20Computer%20Architecture%20I%20-%20ShanghaiTech%20University_files/nano.png"><title>CS110 Longan Nano 配置与使用 - Bill Hu&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/myfont.css"><link rel="stylesheet" href="/css/jetbrains-mono.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"www.billhu.us",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:25,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},gtag:null},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script>!function(t,e,n,c,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/fjnxcr4gva",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta name="google-site-verification" content="IqNfw3GiMxuhw7kYoEdhMJoh3j99KHuGI9bw00hPn2c"><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet"><meta name="generator" content="Hexo 7.1.1"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Bill Hu&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="https://www.billhu.xyz" target="_self"><i class="iconfont icon-code"></i> <span>Portfolio</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="CS110 Longan Nano 配置与使用"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-05-14 00:42" pubdate>May 14, 2024 am</time></span></div><div class="mt-1"></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">CS110 Longan Nano 配置与使用</h1><div class="markdown-body"><h1 id="非官方-cs110-longan-nano-指南"><a class="markdownIt-Anchor" href="#非官方-cs110-longan-nano-指南"></a> 非官方 CS110 Longan Nano 指南</h1><h1 id="lab-11-lab-12-project-3-目的"><a class="markdownIt-Anchor" href="#lab-11-lab-12-project-3-目的"></a> Lab 11, Lab 12, Project 3 目的</h1><ul><li><strong>Lab11</strong>: 领取Longan Nano开发套件；使用 <code>dfu-util</code> 或 <code>DFU tool</code> 烧录固件并测试，确保7个按钮功能正常。Lab11不需要platformio。</li><li><strong>Lab12</strong>: 学会对Longan Nano编程；学会使用platformio编译固件。</li><li><strong>Project3</strong>: 制作Flappy Bird游戏。</li></ul><h1 id="longan-nano-核心版与载板的连接"><a class="markdownIt-Anchor" href="#longan-nano-核心版与载板的连接"></a> Longan Nano 核心版与载板的连接</h1><p>确保Longan Nano每侧只有17个pin，而不是20个。如果是20个，把靠近type-c口的三个排针掰掉。</p><p>“8P排针紧贴此侧”；插到底。</p><h1 id="dfu工具的安装"><a class="markdownIt-Anchor" href="#dfu工具的安装"></a> DFU工具的安装</h1><p>下载地址：<a target="_blank" rel="noopener" href="https://epan.shanghaitech.edu.cn/l/KFjNMO">https://epan.shanghaitech.edu.cn/l/KFjNMO</a></p><p>DFU工具的用途：将已经编译好的固件(<code>.bin</code>)刷入Longan Nano开发板中。</p><h2 id="windows-gd32-mcu-dfu-tool"><a class="markdownIt-Anchor" href="#windows-gd32-mcu-dfu-tool"></a> Windows (GD32 MCU DFU Tool)</h2><p>打开 <code>windows-version\GD32 MCU Dfu Drivers_v1.0.1.2316</code>, 下面有两个文件夹（<code>x86</code>和<code>x64</code>），如果Windows操作系统为64位，请进入 <code>x64</code>；如果系统为32位，请进入 <code>x86</code> (绝大多数情况下，你的电脑是64位的)。</p><p>进入后运行 <code>GD32 MCU Dfu Drivers.exe</code> 安装驱动。</p><p>有可能导致蓝屏，如果电脑蓝屏则重启重试。<s>根据我个人主观的经验，联想电脑蓝屏概率较大？因为该软件官方已经404，且由于Windows驱动程序需要签名，助教无法进行修复。</s> 实在受不了蓝屏的话请换Linux，实体机虚拟机都行。</p><p>打开 <code>windows-version\GD32 MCU Dfu Tool_v3.8.1.5784</code>，运行 <code>GD32 MCU Dfu Tool.exe</code>。</p><h2 id="linux-dfu-util"><a class="markdownIt-Anchor" href="#linux-dfu-util"></a> Linux (dfu-util)</h2><p>找到 <code>linux-version</code> 下的 <code>dfu-util</code>。这是一个可执行文件，在终端中输入 <code>./dfu-util</code> 运行。</p><p>如果出现 “Permission denied”，请先执行 <code>chmod +x ./dfu-util</code>。</p><p>如果刷固件时出现错误，请尝试使用 <code>sudo ./dfu-util</code>。</p><h2 id="macos"><a class="markdownIt-Anchor" href="#macos"></a> macOS</h2><p>通过 homebrew 安装 <code>dfu-util</code>，其余过程同Linux。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install dfu-util<br></code></pre></td></tr></table></figure><h1 id="dfu工具的使用烧录固件的方法"><a class="markdownIt-Anchor" href="#dfu工具的使用烧录固件的方法"></a> DFU工具的使用（烧录固件的方法）</h1><p><strong>第一步：进入DFU模式</strong></p><p>首先需要在Longan Nano上进入DFU模式，进入的方法如下：</p><ol><li>按住 BOOT0 按键，不要松开</li><li>按住 RESET 按键，不要松开</li><li>松开 RESET 按键</li><li>松开 BOOT0 按键</li></ol><p>注意：按键的顺序非常重要，请勿颠倒。如果失败请重试一遍。</p><p>BOOT0按键和RESET按键的位置请查看下图</p><p><img src="https://toast-lab.sist.shanghaitech.edu.cn/courses/CS110@ShanghaiTech/Spring-2023/labs/lab12/Lab%2012%20-%20Computer%20Architecture%20I%20-%20ShanghaiTech%20University_files/nano.png" srcset="/img/loading.gif" lazyload alt="nano.png"></p><p><strong>第二步：下载（刷入）固件</strong></p><ul><li><p>Windows:</p><ul><li><p>运行 <code>GD32 MCU Dfu Tool.exe</code></p></li><li><p>选择 “Download to Device”, 选择需要刷入的固件（后缀名为<code>.bin</code>），可能需要在文件选择器右下角将文件后缀选择到<code>.bin</code>。</p></li><li><p>保持默认 <code>@0x80000000</code>。通常不需要 “Verify After Download” 或 “Erase All”。</p></li><li><p>点击 “OK” 进行刷入。</p><p><strong>如果找不到设备，请检查Longan Nano是否已进入DFU模式；是否已经安装 <code>GD32 MCU Dfu Drivers_v1.0.1.2316</code> 文件夹下的驱动；当前使用的USB typec线是否只能供电不能传数据，可以换一根线重试；请直接插到Longan Nano自带的type-口上，不要插到载板上的“仅供电”口上。</strong></p></li></ul></li><li><p>Linux:</p><ul><li><p>找到 <code>linux-version</code> 下的 <code>dfu-util</code>。输入 <code>./dfu-util</code> 运行。</p><p>如果出现 “Permission denied”，请先执行 <code>chmod +x ./dfu-util</code>。</p><p>如果刷固件时出现错误，请尝试使用 <code>sudo ./dfu-util</code>。</p></li><li><p>执行一下命令，查看dfu-util能否识别到当前设备。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">sudo <span class="hljs-string">./dfu-util</span> <span class="hljs-params">--list</span><br></code></pre></td></tr></table></figure><p>如果输出内容包含 <code>28e9:0189</code>，则代表已经检测到了Longan Nano设备。</p><p>如果有两个或多个ID都为 <code>28e9:0189</code> 的设备，在命令中加入 <code>-a 0</code> 指定alt value为0的设备，即第一个设备（下面的固件刷入命令中含有 <code>./dfu-util -a 0</code> 已经能确保这一点）。</p><p>可以使用 <code>-d 28e9:0189</code> 指定device vender ID和product ID。可以使用 <code>-S</code> 指定serial number。</p><p><strong>如果找不到设备，请检查Longan Nano是否已进入DFU模式；如果使用的是Linux虚拟机，请检查虚拟机的设置，确认USB设备连接在虚拟机上而非Windows主机上；当前使用的USB typec线是否只能供电不能传数据，可以换一根线重试；请直接插到Longan Nano自带的type-口上，不要插到载板上的“仅供电”口上。</strong></p><p>如果能够显示设备但不是 <code>28e9:0189</code>，请尝试使用 <code>lsusb</code> 命令。TODO</p></li><li><p>找到需要刷入的固件（后缀名为 <code>.bin</code>）。假设该 <code>.bin</code> 文件已在当前目录下，使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./dfu-util -a 0 --dfuse-address 0x08000000:leave -D ./lab-longan-nano-firmware-distributable.bin<br></code></pre></td></tr></table></figure><p>如果出现错误，尝试在命令前添加 <code>sudo</code> 并重试。</p><p>如果仍然不行，可以使用 <code>-S</code> 指定serial number。</p><p><strong>如果找不到设备</strong>，看上面。</p></li><li><p>出现 <code>Invalid DFU suffix signature</code> and <code>dfu-util: Error during download get_status</code> 错误可忽略。</p></li></ul></li><li><p>Mac:</p><ul><li><p>通过 homebrew 安装 <code>dfu-util</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install dfu-util<br></code></pre></td></tr></table></figure></li><li><p>剩余过程同Linux</p></li></ul></li></ul><p><strong>第三步：离开DFU模式</strong></p><p>在Longan Nano上按下 RESET 按键即可。或者也可以拔掉 Longan Nano 上的typec线并重新插入（即断电再开机）。</p><hr><p>以下为Lab12的内容</p><h1 id="platformio的安装"><a class="markdownIt-Anchor" href="#platformio的安装"></a> PlatformIO的安装</h1><ul><li><p><strong>推荐使用 vscode 和 PlatformIO IDE 插件的方式</strong>（这也是 <a target="_blank" rel="noopener" href="https://platformio.org">platformio.org</a> 官网推荐的方式），这样能获得最好的开发体验。</p></li><li><p>也可以纯命令行使用 <code>pip</code> 安装 <code>platformio</code> (<code>python3 -m pip install platformio</code>)，终端执行 <code>platformio run</code> 进行编译。</p><p>这样的缺点是IDE代码检查会不正确，像下面一样有很多爆红，体验不是很好，但除此之外不会影响编译和烧录过程。</p><img src="/2024/45_cs11024s_longan/ide-noplatformio-sense.jpg" srcset="/img/loading.gif" lazyload></li><li><p><strong>不要混用两种方法</strong>（即不要既通过 pip 安装 platformio 又安装 vscode 的 PlatformIO IDE 插件；可以先卸载 pip 的 platformio 再去安装 vscode 插件）。</p></li></ul><h2 id="vscode-插件方式"><a class="markdownIt-Anchor" href="#vscode-插件方式"></a> vscode 插件方式</h2><p>在 <a target="_blank" rel="noopener" href="https://toast-lab.sist.shanghaitech.edu.cn/courses/CS110@ShanghaiTech/Spring-2024/labs/Lab12/lab12-starter-20240515.tar.gz">此处</a> 下载 lab12-starter，并解压。</p><img src="/2024/45_cs11024s_longan/vscode-platformioide-plugin.webp" srcset="/img/loading.gif" lazyload><p>插件安装完成之后，点击 vscode 侧边栏中的 PlatformIO 图标，等待初始化完成</p><img src="/2024/45_cs11024s_longan/vscode-21.jpg" srcset="/img/loading.gif" lazyload><p>解压下载的 lab12-starter, 打开该目录并打开里面的 <code>platformio.ini</code> 文件，点击 build。</p><p><strong>如果没有build选项，请卸载coderunner插件。</strong></p><img src="/2024/45_cs11024s_longan/vscode-build.webp" srcset="/img/loading.gif" lazyload><p>由于Sipeed从platformio仓库中移除了Longan nano的开发套件，可能会提示错误。请下载 <a target="_blank" rel="noopener" href="https://epan.shanghaitech.edu.cn/l/KFjNMO">https://epan.shanghaitech.edu.cn/l/KFjNMO</a> 中的Longan Dev Kit，按照里面的说明文档进行开发工具的安装。</p><div class="fold"><div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-3564edf7" role="button" aria-expanded="false" aria-controls="collapse-3564edf7"><div class="fold-arrow">▶</div>Longan Dev Kit的安装说明这些在上面下载的压缩包里都有描述，故此处折叠，可点击展开)</div><div class="fold-collapse collapse" id="collapse-3564edf7"><div class="fold-content"><p>不过还是建议看压缩包里的 <code>README.pdf</code>，那个更详细点。下面是个简述：</p><p>安装platformio后，打开 <code>~/.platformio</code> (Windows下为 <code>C:\Users\&lt;your username&gt;\.platformio</code>) ，里面应该至少有以下文件</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tap">-rw-rw-r--  <span class="hljs-number"> 1 </span>username username <span class="hljs-number"> 177 </span> Mar<span class="hljs-number"> 28 </span>18:04 appstate.json<br>-rw-rw-r--  <span class="hljs-number"> 1 </span>username username <span class="hljs-number"> 199 </span> Mar<span class="hljs-number"> 28 </span>18:29 homestate.json<br>drwxrwxr-x <span class="hljs-number"> 11 </span>username username<span class="hljs-number"> 4096 </span> Mar<span class="hljs-number"> 29 </span>09:39 packages<br>drwxrwxr-x  <span class="hljs-number"> 4 </span>username username<span class="hljs-number"> 4096 </span> Mar<span class="hljs-number"> 29 </span>09:34 platforms<br></code></pre></td></tr></table></figure><p>将提供的Dev Kit中的<code>packages</code>目录里的文件复制到 <code>~/.platformio/packages/</code> 中，将 <code>platforms</code> 目录里的文件复制到 <code>~/.platformio'/platforms</code> 中。</p><p>如果文件不存在（例如，未找到 <code>~/.platformio</code> 目录等），这是因为PlatformIO Home从未打开过。</p></div></div></div><p>然后需要将编译好的固件烧录进 Longan Nano。编译好的固件在 <code>./.pio/build/sipeed-longan-nano/firmware.bin</code>，请参考上文DFU工具的使用将该 <code>.bin</code> 结尾的固件刷入。</p><img src="/2024/45_cs11024s_longan/firmware-location.webp" srcset="/img/loading.gif" lazyload><p>故障排查:</p><ul><li><p>Fail to initialize PlatformIO: 彻底退出vscode并重试</p></li><li><p>Cannot find Python Interpreter when initializing PlatformIO: 参考<a target="_blank" rel="noopener" href="https://github.com/platformio/platformio-core-installer/issues/1774">此处</a>的方法</p></li><li><p>无法编译，找不到 gd32v</p><img src="/2024/45_cs11024s_longan/troubleshoot-nokit.jpg" srcset="/img/loading.gif" lazyload><p>这是没装Longan Dev Kit，请确认安装了 <a target="_blank" rel="noopener" href="https://epan.shanghaitech.edu.cn/l/KFjNMO">https://epan.shanghaitech.edu.cn/l/KFjNMO</a> 中的Longan Dev Kit。</p><p>另外再次确保你在<strong>x86-64</strong> Windows或者<strong>x86-64</strong> Linux环境上进行编译！！</p><p><strong>ARM Linux，ARM Mac，ARM Windows是不行的</strong>，只能烧录，不能编译。</p><p>如果你使用的是ARM的设备，那只能远程（如ssh）一台x86的电脑进行编译，编译完成之后下载<code>firmware.bin</code>到本地进行烧录。</p></li><li><p>无法编译，<code>HTTPClientError</code></p><img src="/2024/45_cs11024s_longan/troubleshoot-httpclienterror.jpg" srcset="/img/loading.gif" lazyload><p>请重新安装PlatformIO。在重新安装的过程中，vscode不要打开 <code>platformio.ini</code>，也不要打开任何含有 <code>platformio.ini</code> 文件的目录！</p><p>这是因为Sipeed把Longan Nano SDK从官网移除了，但没有移除全部，且这个不完整的SDK版本比上面说的 Longan Dev Kit 版本要高，因此即使你安装了Longan Dev Kit，PlatformIO也会使用版本更高的那个不完整的SDK，导致图中<code>HTTPClientError: You do not have permission for this request</code> 的错误。</p></li><li><p>无法编译，提示文件权限问题</p><img src="/2024/45_cs11024s_longan/troubleshoot-permission.jpg" srcset="/img/loading.gif" lazyload><p>这是因为你下载Dev Kit后，先本地解压，再使用某种工具（如scp）将文件拷贝到了远程的另一台电脑上，这一过程文件权限（可执行权限）丢失。</p><p>请拷贝到远程之后再进行解压。</p></li></ul><h2 id="命令行pip方法"><a class="markdownIt-Anchor" href="#命令行pip方法"></a> 命令行pip方法</h2><p>使用 pip 安装 platformio</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">python3 -m pip <span class="hljs-keyword">install</span> platformio<br></code></pre></td></tr></table></figure><p>同样下载 lab12-starter，解压</p><p>下载 <a target="_blank" rel="noopener" href="https://epan.shanghaitech.edu.cn/l/KFjNMO">https://epan.shanghaitech.edu.cn/l/KFjNMO</a> 中的Longan Dev Kit，按照里面的说明文档进行开发工具的安装</p><p>然后使用 <code>platformio run</code> 命令进行编译</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">python3 -m platformio <span class="hljs-built_in">run</span><br></code></pre></td></tr></table></figure><h1 id="杂项"><a class="markdownIt-Anchor" href="#杂项"></a> 杂项</h1><p>这里收集一些Longan Nano开发过程的常见问题，其中有一部分是库的bug，可供参考。</p><h2 id="屏幕纵向显示"><a class="markdownIt-Anchor" href="#屏幕纵向显示"></a> 屏幕纵向显示</h2><p>整体竖屏布局？</p><p>在 <code>lcd.h</code> 中 <code>#define USE_HORIZONTAL 1</code>。</p><h2 id="u16-size问题"><a class="markdownIt-Anchor" href="#u16-size问题"></a> u16 size问题</h2><p>来源：<a target="_blank" rel="noopener" href="https://piazza.com/class/lsvl55gd4jz4h0/post/413">https://piazza.com/class/lsvl55gd4jz4h0/post/413</a></p><p>在<code>lcd.h</code> 中有 <code>#define u16 unsigned int</code> 的宏定义，但通过 <code>sizeof()</code> 会发现u16的size为4 byte，<code>uint16_t</code>和<code>unsigned short</code> 才是正常的2 byte，因此可通过修改这条宏定义解决，解决后编译出的固件大小会近乎减半。</p><h2 id="lcd_show无法充分利用屏幕的问题"><a class="markdownIt-Anchor" href="#lcd_show无法充分利用屏幕的问题"></a> LCD_Show无法充分利用屏幕的问题</h2><p>来源：<a target="_blank" rel="noopener" href="https://piazza.com/class/lsvl55gd4jz4h0/post/416">https://piazza.com/class/lsvl55gd4jz4h0/post/416</a></p><p>在 <code>lcd.c</code> 中，<code>LCD_ShowChar</code> 和 <code>LCD_ShowString</code> 函数没有充分利用屏幕空间。</p><p>屏幕分辨率为160x80，在vertical display mode中，屏幕纵向能显示80 / 8 = 10 chars，但<code>LCD_ShowString</code>函数在第9个char之后就进行了换行，并且 <code>LCD_ShowChar</code> 无法在 <code>(72, 0)</code> 处显示char。</p><p><strong>解决办法</strong>：</p><p>修改 <code>LCD_ShowChar</code> 函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> CHAR_W 8</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CHAR_H 16</span><br><br>    <span class="hljs-keyword">if</span> (x &gt; LCD_W - CHAR_W || y &gt; LCD_H - CHAR_H)<br>        <span class="hljs-keyword">return</span>;      <br></code></pre></td></tr></table></figure><p>修改 <code>LCD_ShowString</code> 函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> CHAR_W 8</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CHAR_H 16</span><br><br>        <span class="hljs-keyword">if</span> (x &gt; LCD_W - CHAR_W)<br>        &#123;<br>            x = <span class="hljs-number">0</span>;<br>            y += CHAR_H;<br>        &#125;<br><br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Lecture-Notes/" class="category-chain-item">Lecture Notes</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/C/" class="print-no-link">#C</a> <a href="/tags/Lecture-Notes/" class="print-no-link">#Lecture Notes</a></div></div><div class="license-box my-3"><div class="license-title"><div>CS110 Longan Nano 配置与使用</div><div>https://www.billhu.us/2024/45_cs11024s_longan/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>Bill Hu</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>May 14, 2024</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2024/46_win11_skip_tpm/" title="Skip TPM check when installing Windows 11"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Skip TPM check when installing Windows 11</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/2024/44_fcpx_crack/" title="Free Official FCPX"><span class="hidden-mobile">Free Official FCPX</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <span>With </span><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <a href="/about" target="_blank" rel="nofollow noopener"><span>Bill Hu</span></a><div style="font-size:.85rem"><span id="timeDate">Loading days...</span> <span id="times">Loading time...</span><script src="/js/duration.min.js"></script></div></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>