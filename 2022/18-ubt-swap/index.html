<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>
<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/code.png">
  <link rel="icon" href="/img/code.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="BillHu">
  <meta name="keywords" content="">
    <meta name="description" content="The way to turn on&#x2F;off swap, or changing the size of swap, on Ubuntu. Other linux distributions are similar.">
<meta property="og:type" content="article">
<meta property="og:title" content="How to configure swap on Ubuntu">
<meta property="og:url" content="https://billhu.cn/2022/18-ubt-swap/index.html">
<meta property="og:site_name" content="Bill Hu&#39;s Blog">
<meta property="og:description" content="The way to turn on&#x2F;off swap, or changing the size of swap, on Ubuntu. Other linux distributions are similar.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://billhu.cn/2022/18-ubt-swap/free_m_withswap.png">
<meta property="og:image" content="https://billhu.cn/2022/18-ubt-swap/swapon.png">
<meta property="og:image" content="https://billhu.cn/2022/18-ubt-swap/fstab.png">
<meta property="article:published_time" content="2022-02-13T08:34:56.000Z">
<meta property="article:modified_time" content="2022-03-27T12:59:53.872Z">
<meta property="article:author" content="BillHu">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Ubuntu">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://billhu.cn/2022/18-ubt-swap/free_m_withswap.png">
  <title>How to configure swap on Ubuntu - Bill Hu&#39;s Blog</title>
  <link  rel="stylesheet" href="/css/bootstrap.min.css" />
  <link  rel="stylesheet" href="/css/github-markdown.min.css" />
  <link  rel="stylesheet" href="/css/hint.min.css" />
      <link  rel="stylesheet" href="/css/github-gist.min.css" />
    <link  rel="stylesheet" href="/css/jquery.fancybox.min.css" />
<!-- 主题依赖的图标库，不要自行修改 -->
<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">
<link  rel="stylesheet" href="/css/main.css" />
<!-- 自定义样式保持在最底部 -->
  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"billhu.cn","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":30,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/katex.min.css">
<link rel="stylesheet" href="/css/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head>
<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Bill Hu&#39;s Blog</strong>
    </a>
    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>
    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="banner" id="banner" parallax=true
         style="background: url('https://pic.imgdb.cn/item/621b03fb2ab3f51d912cf1f2.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="How to configure swap on Ubuntu">
            </span>
              <div class="mt-3">
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      BillHu
    </span>
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-02-13 16:34" pubdate>
        February 13, 2022 pm
      </time>
    </span>
</div>
<div class="mt-1">
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.4k words
    </span>
</div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <main>
<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">How to configure swap on Ubuntu</h1>
            <div class="markdown-body">
              <h2 id="what-is-swap"><a class="markdownIt-Anchor" href="#what-is-swap"></a> What is ‘swap’?</h2>
<p>Linux devides its physical RAM into chunks of memory called <strong>pages</strong>. <strong>Swapping</strong> is the process whereby a page of memory is copied to the preconfigured space on the hard disk called <strong>swap space</strong>, to free up that page of memory.</p>
<p>The compined sizes of the physical memory and swap space is the amount of virtual memory available.</p>
<div class="note note-success">
            <p>In brief, swap is to cut some space on the hard disk to be used as an extended memory. When almost running out of physical memory, Linux system will move some relatively inactive memory to swap, in order to relieve the memory pressure.</p>
          </div>
<p>Usually, raspi or some lightweight server have only a small physical memory (1-2 Gigabytes). Should you encounter problems because of exhausted memory, you can use swap to ‘enlarge’ it.</p>
<h2 id="part-1-turn-on-or-enlarge-swap"><a class="markdownIt-Anchor" href="#part-1-turn-on-or-enlarge-swap"></a> Part 1. Turn on or enlarge swap</h2>
<h3 id="step0-see-the-current-size-of-swap"><a class="markdownIt-Anchor" href="#step0-see-the-current-size-of-swap"></a> Step0. See the current size of swap</h3>
<p>Use <code>free</code> in shell can let you see your memory usage, including the size of physical memory and swap. Usually we use <code>free -m</code> to let it display numbers in unit ‘MB’.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">free -m<br></code></pre></td></tr></table></figure>
<p>If the row ‘swap’ shows zero, it indicates you does not have swap currently.</p>
<img src="/2022/18-ubt-swap/free_m_withswap.png" srcset="/img/loading.gif" lazyload class="">
<h3 id="step1-create-a-swap-file"><a class="markdownIt-Anchor" href="#step1-create-a-swap-file"></a> Step1. Create a swap file</h3>
<p>In terminal, execute</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo dd if=/dev/zero of=/swapfile bs=1M count=4096<br></code></pre></td></tr></table></figure>
<p>where <code>bs=1M count=4096</code> means the unit is 1M, and create 4096 units (which equals 4 Gigabytes) of virtual memory. You can change the size based on your need.</p>
<p>This command writes an empty file of a specified size named and located at <code>/swapfile</code>. Since it requires hard disk IO, it might take some time.</p>
<h3 id="step2-change-the-permission-of-swapfile-and-activate-the-swap"><a class="markdownIt-Anchor" href="#step2-change-the-permission-of-swapfile-and-activate-the-swap"></a> Step2. Change the permission of swapfile and activate the swap</h3>
<p>Then we need to change the permission (<code>chmod</code>) of the swapfile we have just created to 600.</p>
<p>You can still use the swap later if you skip this step, but the following operations may throw you a warning. For safety issues, you are NOT RECOMMENDED to skip this.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo chmod 600 /swapfile<br></code></pre></td></tr></table></figure>
<p>After that, we need to make this normal file a swapfile. In terminal, execute</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mkswap /swapfile<br>sudo swapon /swapfile<br></code></pre></td></tr></table></figure>
<p>If succeeds, you can see the fillowing prompt</p>
<img src="/2022/18-ubt-swap/swapon.png" srcset="/img/loading.gif" lazyload class="">
<div class="note note-info">
            <p>Now you can use <code>free -m</code> command again to check whether the swap is successfully turned on.</p>
          </div>
<h3 id="step3-turn-on-the-swap-automatically-at-system-startup"><a class="markdownIt-Anchor" href="#step3-turn-on-the-swap-automatically-at-system-startup"></a> Step3. Turn on the swap automatically at system startup</h3>
<p>Despite that we have configured swap now, it cannot live after a restart. To let it start automatically at booting, we have to modify <code>/etc/fstab</code> file.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo vim /etc/fstab<br></code></pre></td></tr></table></figure>
<p>Add the following line at the end of file, save, and exit.</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">/swapfile <span class="hljs-keyword">swap</span> <span class="hljs-keyword">swap</span> defaults <span class="hljs-number">0</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>The contents of this file should look similar to the following</p>
<img src="/2022/18-ubt-swap/fstab.png" srcset="/img/loading.gif" lazyload class="" title="&#x2F;etc&#x2F;fstab">
<p>Now you have successfully configured swap and make it start automatically at boot.</p>
<h3 id="optional-step4-change-swapiness"><a class="markdownIt-Anchor" href="#optional-step4-change-swapiness"></a> (Optional) Step4. Change swapiness</h3>
<p>Swapiness’s value controls the system’s likelihood to use virtual memory. A higher value indicates using the swap partition more frequently, and a lower value means using physical memory more likely.</p>
<p>The default value of swappiness is usually <code>60</code>, and there’s usually <strong>no need to modify it</strong>.</p>
<p>The following command can let us know the current swapiness</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /proc/sys/vm/swappiness<br></code></pre></td></tr></table></figure>
<ul>
<li>Modify the swappiness temporily (restart will restore the original value)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo sysctl vm.swappiness = 10  # Change 10 to your needed value<br></code></pre></td></tr></table></figure>
<ul>
<li>Modify the swappiness permanently</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo vim /etc/sysctl.conf<br></code></pre></td></tr></table></figure>
<p>Add to (or modify) the end of the file:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vm.swappiness=10  <span class="hljs-comment"># Change 10 to your needed value</span><br></code></pre></td></tr></table></figure>
<p>Save and exit, then execute</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo sysctl -p<br></code></pre></td></tr></table></figure>
<p>and you can change the swappiness successfully.</p>
<h2 id="part-2-turn-off-and-delete-swap"><a class="markdownIt-Anchor" href="#part-2-turn-off-and-delete-swap"></a> Part 2: Turn off and delete swap</h2>
<h3 id="step1-stop-using-swapfile"><a class="markdownIt-Anchor" href="#step1-stop-using-swapfile"></a> Step1. Stop using swapfile</h3>
<p>If you want to cut down the swap size or removing the swap, you have to find the location of swapfile first. If you added the swap by the above steps, the swapfile should be located in the root directory <code>/swapfile</code>. Otherwise, find the location first by using the following command</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">cat /proc/swaps<br></code></pre></td></tr></table></figure>
<p>After finding the location, execute the following to disable the swap:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo swapoff -v /swapfile <br></code></pre></td></tr></table></figure>
<h3 id="step2-delete-the-configuration-in-etcfstab"><a class="markdownIt-Anchor" href="#step2-delete-the-configuration-in-etcfstab"></a> Step2. Delete the configuration in <code>/etc/fstab</code></h3>
<p>Modify <code>/etc/fstab</code> file:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo vim /etc/fstab<br></code></pre></td></tr></table></figure>
<p>and remove the line corresponding to the swapfile.</p>
<h3 id="step3-remove-swapfile"><a class="markdownIt-Anchor" href="#step3-remove-swapfile"></a> Step3. Remove swapfile</h3>
<p>Execute</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo rm /swapfile<br></code></pre></td></tr></table></figure>
<p>to delete the swapfile and free up space on the hard disk.</p>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                      <a class="hover-with-bg" href="/categories/Linux/">Linux</a>
                  </div>
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                      <a class="hover-with-bg" href="/tags/Linux/">Linux</a>
                      <a class="hover-with-bg" href="/tags/Ubuntu/">Ubuntu</a>
                  </div>
              </div>
                <p class="note note-warning">
                    Unless otherwise stated, all articles on this blog uses <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 </a>. Please indicate the source of reproduction!
                </p>
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                      <a href="/2022/20-ubuntu-config/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">(unfinished) Ubuntu configs</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                  </article>
                  <article class="post-next col-6">
                      <a href="/2022/19-linux-commands/">
                        <span class="hidden-mobile">Some Linux shell commands</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                  </article>
                </div>
            </div>
          </article>
        </div>
      </div>
    </div>
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>
      </div>
  </div>
</div>
<!-- Custom -->
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  </main>
  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration_en.js"></script> </div> 
  </div>
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        沪ICP备2022004216号
      </a>
    </span>
  </div>
</footer>
  <!-- SCRIPTS -->
  <script  src="/js/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="/css/nprogress.min.css" />
  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>
<script  src="/js/jquery.min.js" ></script>
<script  src="/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>
<!-- Plugins -->
  <script  src="/js/local-search.js" ></script>
    <script  src="/js/img-lazyload.js" ></script>
    <script  src="/js/tocbot.min.js" ></script>
    <script  src="/js/jquery.fancybox.min.js" ></script>
    <script  src="/js/anchor.min.js" ></script>
    <script defer src="/js/clipboard.min.js" ></script>
  <script  src="/js/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
        typing(title);
    })(window, document);
  </script>
<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>
</body>
</html>
