<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Bill Hu"><meta name="keywords" content=""><meta name="description" content="The basic concepts, the installation, and the usage of Docker (on Linux)"><meta property="og:type" content="article"><meta property="og:title" content="Docker"><meta property="og:url" content="https://www.billhu.us/2022/27_docker/index.html"><meta property="og:site_name" content="Bill Hu&#39;s Blog"><meta property="og:description" content="The basic concepts, the installation, and the usage of Docker (on Linux)"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.billhu.us/2022/27_docker/docker_version.png"><meta property="og:image" content="https://www.billhu.us/2022/27_docker/docker_gitlab_console.png"><meta property="og:image" content="https://www.billhu.us/2022/27_docker/docker_gitlab_password2.png"><meta property="article:published_time" content="2022-04-19T09:44:18.000Z"><meta property="article:modified_time" content="2024-07-12T16:13:51.429Z"><meta property="article:author" content="Bill Hu"><meta property="article:tag" content="Linux"><meta property="article:tag" content="nginx"><meta property="article:tag" content="docker"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.billhu.us/2022/27_docker/docker_version.png"><title>Docker - Bill Hu&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/myfont.css"><link rel="stylesheet" href="/css/jetbrains-mono.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"www.billhu.us",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:25,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},gtag:null},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script>!function(t,e,n,c,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/fjnxcr4gva",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta name="google-site-verification" content="IqNfw3GiMxuhw7kYoEdhMJoh3j99KHuGI9bw00hPn2c"><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet"><meta name="generator" content="Hexo 7.1.1"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Bill Hu&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item"><a class="nav-link" href="https://about.billhu.us" target="_self"><i class="iconfont icon-code"></i> <span>Portfolio</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Docker"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-04-19 09:44" pubdate>April 19, 2022 am</time></span></div><div class="mt-1"></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">Docker</h1><div class="markdown-body"><h2 id="official-website-and-docs"><a class="markdownIt-Anchor" href="#official-website-and-docs"></a> Official website and docs</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com">https://docs.docker.com</a></p><h2 id="what-is-docker"><a class="markdownIt-Anchor" href="#what-is-docker"></a> What is docker</h2><blockquote><p>Docker is an open platform for developing, shipping, and running applications. Docker enables you to separate your applications from your infrastructure so you can deliver software quickly. With Docker, you can manage your infrastructure in the same ways you manage your applications.</p></blockquote><p>In short, docker behaves similar to virtual machines, except that it is extremely lightweight compared to the former one.</p><h3 id="three-import-concepts"><a class="markdownIt-Anchor" href="#three-import-concepts"></a> Three import concepts</h3><ul><li><p><strong>Image</strong>: Image is similar to the ISO file of an virtual machine, which includes a readonly filesystem. Image provides a runtime environment which all application needs in order to run.</p><p>For example, an ubuntu image is a template environment including the ubuntu operating system. If we install Apache software on it, that image can be called an Apache image.</p></li><li><p><strong>Container</strong>: You can run several <strong>containers</strong> (virtual machines) in a computer, each in an isolated environment. A container behaves like a lightweight sandbox. You can regard it as a simple linux system environment (including process space, user space, network space, and the applications running inside it).</p><p>Container is the instantiate application created by an image. You can create, start, stop, or delete a container, without affecting your host system. You can choose whether to share some network ports, files or so on between your host machine and the containers.</p><p>Note that the image itself is readonly. When you start a container using an image, docker creates a writable layer on the top of the image, while the image itself is still readonly.</p></li><li><p><strong>Repository</strong>: Like a code repo, the image repository is where the docker stores the centralized images.</p><p>Note the difference between <strong>Repository</strong> and <strong>Registry</strong>:</p><ul><li>The registry is the space to store repositories, generally consists of multiple repos.</li><li>The Repository is the space to store images.</li><li>Normally each repository stores a single kind of images, distinguished by tags. For example, the ubuntu registry stores multiple versions (18.04, 20.04, etc) of ubuntu images.</li></ul></li></ul><h2 id="uninstall-docker"><a class="markdownIt-Anchor" href="#uninstall-docker"></a> Uninstall docker</h2><p>To remove previous docker installations and configurations, e.g., the old version of docker, you can do the following:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">sudo apt <span class="hljs-built_in">remove</span> docker docker-engine docker.<span class="hljs-built_in">io</span> containerd runc<br></code></pre></td></tr></table></figure><p>It’s OK if none of these packages are installed.</p><p>The contents of <code>/var/lib/docker/</code>, including docker images, containers, etc, are preserved. If you want to remove them, use</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">sudo apt purge docker-ce docker-ce-cli containerd.io<br>sudo rm -rf <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker /</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/lib/</span>containerd<br></code></pre></td></tr></table></figure><p>You still need to manually delete any modified configurations after that.</p><h2 id="install-docker"><a class="markdownIt-Anchor" href="#install-docker"></a> Install docker</h2><p>There’re several ways to install docker. You can install it via <code>apt</code>, or a <code>deb</code> file, or the script.</p><h3 id="install-using-the-convenience-script"><a class="markdownIt-Anchor" href="#install-using-the-convenience-script"></a> Install using the convenience script</h3><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">curl</span> -<span class="hljs-string">fsSL</span> <span class="hljs-string">https</span>://<span class="hljs-string">get</span>.<span class="hljs-string">docker</span>.<span class="hljs-string">com</span> -<span class="hljs-string">o</span> <span class="hljs-built_in">get-docker.sh</span><br><span class="hljs-string">sudo</span> <span class="hljs-string">sh</span> <span class="hljs-built_in">get-docker.sh</span><br></code></pre></td></tr></table></figure><div class="note note-info"><p>To use Aliyun mirror, execute <code>sudo sh get-docker.sh --mirror Aliyun</code></p></div><p>Wait until the installation finishes. On debian or ubuntu, the docker service is automatically started after the installation. To make it start at system boot, use the following;</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo systemctl <span class="hljs-built_in">enable</span> docker.service<br>sudo systemctl <span class="hljs-built_in">enable</span> containerd.service<br></code></pre></td></tr></table></figure><h3 id="optional-manage-docker-as-a-non-root-user"><a class="markdownIt-Anchor" href="#optional-manage-docker-as-a-non-root-user"></a> (Optional) Manage docker as a non-root user</h3><p>The docker daemon requires to be run as root because it binds a Unix socket instead of a TCP port, which is only owned by user root. That’s why the installation script and docker itself needs to be executed by <code>sudo</code>. If you don’t want to preface the docker command with sudo, you can create a usergroup called docker and add users to it.</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">sudo</span> groupadd docker<br>sudo usermod -aG docker <span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure><p>Log out and log in to make sure the group membership is re-evaluated. You can also try <code>newgrp docker</code> to activate the changes to groups.</p><h3 id="verify-that-docker-is-installed-and-functioning"><a class="markdownIt-Anchor" href="#verify-that-docker-is-installed-and-functioning"></a> Verify that docker is installed and functioning</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">docker <span class="hljs-comment">--version</span><br></code></pre></td></tr></table></figure><p>The output should look similar to</p><img src="/2022/27_docker/docker_version.png" srcset="/img/loading.gif" lazyload><p>Then,</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> hello-world<br></code></pre></td></tr></table></figure><p>If you see the output of hello-world, the docker is functioning well. This command does the following steps:</p><ul><li>First, check if you have an image called <code>hello-world</code> locally. No local image was found.</li><li>Then it looks the docker hub (the default source is ‘<a target="_blank" rel="noopener" href="http://hub.docker.com">hub.docker.com</a>’) to see if there’s an online image called <code>hello-world</code>. It found that image, and pull (download) it, equivalent to <code>docker pull hello-world</code>.</li><li>Finally it starts a container with the image, and the executable files inside the container produces the output what you see on the terminal screen.</li></ul><h2 id="usage-of-docker-containers"><a class="markdownIt-Anchor" href="#usage-of-docker-containers"></a> Usage of docker containers</h2><h3 id="download-pull-an-image"><a class="markdownIt-Anchor" href="#download-pull-an-image"></a> Download (pull) an image</h3><p>Taking ubuntu image as an example. We can use <code>docker pull ubuntu</code> to get the ubuntu image. Note that every repository have multiple images separated by tags. Without entering a tag, it uses <code>latest</code> by default.</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker pull ubuntu</span><br></code></pre></td></tr></table></figure><p>After that, list the images to check if we have downloaded</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p>To remove an image, use</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker rmi xxx</span><br></code></pre></td></tr></table></figure><h3 id="run-a-container-using-an-image"><a class="markdownIt-Anchor" href="#run-a-container-using-an-image"></a> Run a container using an image</h3><p>As we have downloaded ubuntu image just now, we want to start it in a container. We can use the following</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> ubuntu:latest /bin/bash<br></code></pre></td></tr></table></figure><p>Here the <code>-i</code> means ‘interactive’: open and keeping ‘stdout’; <code>-t</code> means creating a pseudo-tty, in order to let us execute bash inside the container and ‘use’ the terminal of it.</p><p>If we use <code>exit</code> to exit the container, the container will be exited instead of running in the background. If we want the container to keep running, use <code>ctrl+p</code>, <code>ctrl+q</code> to exit, and the status of the container will be <code>up</code>.</p><p>Besides that, <code>docker run</code> command have a lot of acceptable arguments such as</p><ul><li><code>-d</code>: detached, running in the background. Nothing will be output to the terminal. Instead, all ‘stdout’ will be redirected to a log, which you can see with `docker logs CONTAINER_NAME/CONTAINER_ID1</li></ul><h3 id="manage-containers"><a class="markdownIt-Anchor" href="#manage-containers"></a> Manage containers</h3><ul><li><p>View all running containers</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker ps</span><br></code></pre></td></tr></table></figure><p>View all containers</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker ps -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure></li><li><p>Start, stop or Restart a container:</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">docker <span class="hljs-literal">start</span>/<span class="hljs-literal">stop</span>/restart CONTAINER_NAME/CONTAINER_ID<br></code></pre></td></tr></table></figure></li><li><p>Go inside a container after start it in the background</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">docker attach CONTAINER_NAME/CONTAINER_ID<br></code></pre></td></tr></table></figure></li><li><p>Remove a container</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">rm</span> CONTAINER_NAME/CONTAINER_ID<br></code></pre></td></tr></table></figure></li></ul><h2 id="some-interesting-docker-images"><a class="markdownIt-Anchor" href="#some-interesting-docker-images"></a> Some interesting docker images</h2><h3 id="install-gitlab-using-docker"><a class="markdownIt-Anchor" href="#install-gitlab-using-docker"></a> Install gitlab using docker</h3><p><strong>Step1</strong>: pull gitlab’s docker image</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull gitlab/gitlab-ce<br></code></pre></td></tr></table></figure><p><strong>Step2</strong>: run gitlab</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">docker run <span class="hljs-params">--detach</span> \<br>  <span class="hljs-params">--hostname</span> gitlab.example.com \<br>  <span class="hljs-params">--publish</span> 443<span class="hljs-function">:443</span> <span class="hljs-params">--publish</span> 80<span class="hljs-function">:80</span> <span class="hljs-params">--publish</span> 22<span class="hljs-function">:22</span> \<br>  <span class="hljs-params">--name</span> gitlab \<br>  <span class="hljs-params">--restart</span> always \<br>  <span class="hljs-params">--volume</span> <span class="hljs-string">/srv/gitlab/config</span>:<span class="hljs-string">/etc/gitlab</span> \<br>  <span class="hljs-params">--volume</span> <span class="hljs-string">/srv/gitlab/logs</span>:<span class="hljs-string">/var/log/gitlab</span> \<br>  <span class="hljs-params">--volume</span> <span class="hljs-string">/srv/gitlab/data</span>:<span class="hljs-string">/var/opt/gitlab</span> \<br>  gitlab/gitlab-ce<span class="hljs-function">:latest</span><br></code></pre></td></tr></table></figure><p>The meaning of the command is as follows:</p><ul><li><code>--name gitlab</code>: the container name</li><li><code>--restart always</code>: always let the container running, to let the container start at system boot</li><li><code>--publish 443:443 --publish 80:80 --publish 22:22</code>: Map network ports<br>You may want to use another port than 80, 443, as it might be occupied by another service like nginx or apache. Change to <code>--publish HOST_PORT:CONTAINER_PORT</code> to map port HOST_PORT of the host to CONTAINER_PORT in the container (e.g. <code>--publish 20080:80</code>).</li><li><code>--volume /srv/gitlab/config:/etc/gitlab</code>: map gitlab config, log, and data directories</li><li><code>gitlab/gitlab-ce:latest</code>: the image you need to run</li></ul><p><strong>Step3</strong>: Check the container status</p><p>Use</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">docker <span class="hljs-keyword">container</span> <span class="hljs-keyword">ls</span><br></code></pre></td></tr></table></figure><p>to list all containers, which should have the gitlab container you have just created. The status <code>starting</code> means it is initializing. Wait it until the status become <code>healthy</code>.</p><p>After the initialization is complete, visit <code>http://your_ip:HOST_PORT</code> and you should see the gitlab login page.</p><p><strong>Step 4</strong>: Modify user root’s password</p><p>The default (and the admin) user is ‘root’ in gitlab, and the default password is a randomly generated long string. We have to go into the gitlab container and modify the password.</p><p>Use <code>docker ps</code> to see the gitlab container ID, and use (replace <code>ce539268a90c</code> with the container ID)</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker exec -<span class="hljs-keyword">it</span> ce539268a90c bash<br></code></pre></td></tr></table></figure><p>to enter the terminal of the container.</p><p>Then, inside the container, execute</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /opt/gitlab/bin<br>gitlab-rails console  <span class="hljs-comment"># this may take some time</span><br></code></pre></td></tr></table></figure><p>and you should see the following</p><img src="/2022/27_docker/docker_gitlab_console.png" srcset="/img/loading.gif" lazyload><p>After that, find the root user by entering</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">u=User.<span class="hljs-keyword">where</span>(<span class="hljs-built_in">id</span>:<span class="hljs-number">1</span>).<span class="hljs-keyword">first</span><br></code></pre></td></tr></table></figure><p>and change its password by entering</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">u.password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;12345678&#x27;</span><br>u.password_confirmation<span class="hljs-operator">=</span><span class="hljs-string">&#x27;12345678&#x27;</span><br>u.save<br></code></pre></td></tr></table></figure><p>and the password is changed.</p><img src="/2022/27_docker/docker_gitlab_password2.png" srcset="/img/loading.gif" lazyload><h3 id="install-qduoj-using-docker"><a class="markdownIt-Anchor" href="#install-qduoj-using-docker"></a> Install qduOJ using docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> -b 2.0 https://github.com/QingdaoU/OnlineJudgeDeploy.git<br><span class="hljs-built_in">cd</span> OnlineJudgeDeploy<br></code></pre></td></tr></table></figure><p>Before continuing, make sure the 80 and 443 port are not occupied by other processes. Otherwise, use another port (and you make want to reverse proxy it using nginx).</p><p>In the end of <code>docker-compose.yml</code>, modify <code>ports</code> contents. For example, if you want to use the host’s 10000 and 10001 port, use</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;0.0.0.0:10000:8000&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;0.0.0.0:10001:1443&quot;</span><br></code></pre></td></tr></table></figure><p>Then</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker compose up -d</span> <br></code></pre></td></tr></table></figure><p>and wait until the container status (see with <code>docker ps -a</code>) becomes ‘healthy’.</p><h3 id="install-umami-to-statistic-your-website-visits"><a class="markdownIt-Anchor" href="#install-umami-to-statistic-your-website-visits"></a> Install umami to statistic your website visits</h3><p>The easiest way to configure umami is to install it by docker. You don’t need to install database (mysql, mariadb, …), nor do you need to fight with npm (<code>npm install</code>, <code>npm run build</code>).</p><p>What you need is</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/mikecao/umami.git<br>docker compose up -d<br></code></pre></td></tr></table></figure><p>And umami is installed. Visit 3000 port to see the umami page. The default username is <code>admin</code> and passwd is <code>umami</code>.</p><p>Just a reminder: when inserting the tracking code into your html, avoid embedding http content into https website. Obtain an SSL cert to your umami website to make it https.</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Cross-Platform/" class="category-chain-item">Cross Platform</a> <span>></span> <a href="/categories/Cross-Platform/docker/" class="category-chain-item">docker</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Linux/" class="print-no-link">#Linux</a> <a href="/tags/nginx/" class="print-no-link">#nginx</a> <a href="/tags/docker/" class="print-no-link">#docker</a></div></div><div class="license-box my-3"><div class="license-title"><div>Docker</div><div>https://www.billhu.us/2022/27_docker/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>Bill Hu</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>April 19, 2022</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/27_2_docker_gitlab/" title="Build a Gitlab server using Docker"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Build a Gitlab server using Docker</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/2022/26_lets_encrypt_ssl/" title="Deploy free SSL certificates for all your nginx websites"><span class="hidden-mobile">Deploy free SSL certificates for all your nginx websites</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <span>With </span><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <a href="/about" target="_blank" rel="nofollow noopener"><span>Bill Hu</span></a><div style="font-size:.85rem"><span id="timeDate">Loading days...</span> <span id="times">Loading time...</span><script src="/js/duration.min.js"></script></div></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>